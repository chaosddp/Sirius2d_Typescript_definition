this.ss2d=this.ss2d||{},function(){ss2d.debug=!1,ss2d.version="0.4.1",ss2d.xmlUnderline=!0,ss2d.global=window,ss2d.nocache="",ss2d.useMouseMove=!1,ss2d.canvas=document.createElement("canvas"),ss2d.context=ss2d.canvas.getContext("2d"),ss2d.sound={config:{MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}}},ss2d.$=function(t){return"#"==t.charAt(0)?document.getElementById(t.substr(1)):document.getElementsByTagName(t)},ss2d.$new=function(t){return document.createElement(t)},ss2d.log=function(){if("undefined"!=typeof console&&ss2d.debug){var t=Array.prototype.slice.call(arguments);console.log(t.join(","))}},ss2d.copy=function(t){if(!t||"object"!=typeof t||t instanceof HTMLElement||t instanceof ss2d.Class)return t;if(t instanceof Array){for(var e=[],s=0,i=t.length;i>s;s++)e[s]=ss2d.copy(t[s]);return e}var e={};for(var s in t)e[s]=ss2d.copy(t[s]);return e},ss2d.merge=function(t,e){for(var s in e){var i=e[s];"object"!=typeof i||i instanceof HTMLElement||i instanceof ss2d.Class?t[s]=i:(t[s]&&"object"==typeof t[s]||(t[s]=i instanceof Array?[]:{}),ss2d.merge(t[s],i))}return t},ss2d.getElementOffset=function(t){for(var e=t.offsetLeft,s=t.offsetTop;(t=t.offsetParent)&&t!=document.body&&t!=document;)e+=t.offsetLeft,s+=t.offsetTop;return{left:e,top:s}},ss2d.ksort=function(t){if(!t||"object"!=typeof t)return[];var e=[],s=[];for(var i in t)e.push(i);e.sort();for(var r=0;e.length>r;r++)s.push(t[e[r]]);return s},ss2d.proxy=function(t,e){var s=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,Array.prototype.slice.call(arguments,0).concat(s))}},ss2d.radianToDegree=function(t){return t*(180/Math.PI)},ss2d.degreeToRadian=function(t){return Math.PI*t/180},ss2d.hitTrianglePoint=function(t,e,s){return 0>(e.x-t.x)*(e.y+t.y)+(s.x-e.x)*(s.y+e.y)+(t.x-s.x)*(t.y+s.y)?1:0},ss2d.hitPoint=function(t,e,s,i){var r=ss2d.hitTrianglePoint(t,e,s),a=ss2d.hitTrianglePoint(i,e,s),n=ss2d.hitTrianglePoint(t,e,i),o=ss2d.hitTrianglePoint(t,i,s);return a==r&&n==r&&o==r?!0:!1},ss2d.orthographicViewportMatrix=function(t,e,s,i,r,a,n){t[0]=2/(s-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2/(r-i),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1/(n-a),t[11]=0,t[12]=(s+e)/(s-e),t[13]=(i+r)/(i-r),t[14]=a/(a-n),t[15]=1},ss2d.getScope=function(t){for(var e=2;t>e;)e<<=1;return e},ss2d.isPower_2=function(t){return 0!=t?0==(t&t-1)?!0:!1:void 0},ss2d.browserPrefix="",ss2d.supportsFullScreen=function(){var t="webkit moz o ms khtml".split(" ");if(document.cancelFullScreen!==void 0)return!0;for(var e=0,s=t.length;s>e;e++)if(ss2d.browserPrefix=t[e],document[ss2d.browserPrefix+"CancelFullScreen"]!==void 0)return!0;return!1},ss2d.isFullScreen=function(){switch(ss2d.browserPrefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[ss2d.browserPrefix+"FullScreen"]}},ss2d.requestFullScreen=function(){if(ss2d.supportsFullScreen()){var t=ss2d.Stage2D.canvas?ss2d.Stage2D.canvas:ss2d.canvas;""===ss2d.browserPrefix?t.requestFullScreen():t[ss2d.browserPrefix+"RequestFullScreen"]()}},ss2d.cancelFullScreen=function(){return ss2d.supportsFullScreen()?""===ss2d.browserPrefix?document.cancelFullScreen():document[ss2d.browserPrefix+"CancelFullScreen"]():void 0},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,Number.prototype.map=function(t,e,s,i){return s+(i-s)*((this-t)/(e-t))},Number.prototype.limit=function(t,e){return Math.min(e,Math.max(t,this))},Number.prototype.round=function(t){return t=Math.pow(10,t||0),Math.round(this*t)/t},Number.prototype.floor=function(){return Math.floor(this)},Number.prototype.ceil=function(){return Math.ceil(this)},Number.prototype.toInt=function(){return 0|this},Array.prototype.erase=function(t){for(var e=this.length;e--;)this[e]===t&&this.splice(e,1);return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Function.prototype.bind=function(t){var e=this;return function(){var s=Array.prototype.slice.call(arguments);return e.apply(t||null,s)}}}(),function(t){"use strict";function e(t,e){t.toString=function(){return e}}function s(t,e){t.toString=function(){return e}}function i(t,e){t.prototype.toString=function(){return e}}var r=function(t,e,a){var n,o,h,u,l;return 2>arguments.length&&(e=t,t=""),n=e.Extends||null,delete e.Extends,o=e.Implements||null,delete e.Implements,u=e.initialize||null,delete e.initialize,u||(u=n?function(){n.apply(this,arguments)}:function(){}),h=t.substr(t.lastIndexOf(".")+1),l=Function("initialize","return function "+h+"() { initialize.apply(this, arguments); }")(u),s(l,t),r.inherit(l,n),r.implement(l,o),i(l,t),r.extend(l,e,!0),a||r.namespace(t,l),l};r.augment=function(t,s,i){var r,a,n,o,h;for(r in s)s.hasOwnProperty(r)&&(n=t.hasOwnProperty(r),(i||!n)&&(a=t[r]=s[r],"function"==typeof a&&(o=s.toString===Object.prototype.toString,h=o?t.constructor:s.constructor,e(a,h+"::"+r))))},r.extend=function(t,e,s){e.STATIC&&(t.Super&&r.augment(t,t.Super._STATIC_,!0),r.augment(t,e.STATIC,!0),t._STATIC_=e.STATIC,delete e.STATIC),r.augment(t.prototype,e,s)},r.inherit=function(t,e){if(e){var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t,t.Super=e,r.extend(t,e,!1)}},r.implement=function(t,e){if(e){var s;for("function"==typeof e&&(e=[e]),s=0;e.length>s;s+=1)r.augment(t.prototype,e[s].prototype,!1)}},r.namespace=function(e,s){if(t.define===void 0){var i,r,a,n,o;for(i=e.split("."),r=i[i.length-1],a=t,o=0;i.length-1>o;o+=1)n=i[o],a[n]===void 0&&(a[n]={}),a=a[n];a[r]=s}},"undefined"!=typeof define?define("Class",[],function(){return r}):t&&(t.Class=r)}("undefined"!=typeof define||"undefined"==typeof window?exports:window),function(t){function e(t){function e(t,e){return function(){var i="Missing implementation for <"+this+"::"+e+"> defined by interface "+t;throw new s(i)}}var s=function(t){this.name="ImplementationMissingError",this.message=t||""};s.prototype=Error.prototype;var i=function(s,i,r){if("string"!=typeof s)throw Error('Please give your interface a name. Pass "true" as last parameter to avoid global namespace pollution');var a,n,o=s.substr(s.lastIndexOf(".")+1),h=Function("return function "+o+"() {}")();for(a in i)i.hasOwnProperty(a)&&(n=i[a],h.prototype[a]=e(s,a,n));return r||t.namespace(s,h),h.toString=function(){return o},h};return i.ImplementationMissingError=s,i}if("undefined"!=typeof define)define("Interface",["Class"],function(t){return e(t)});else if("undefined"!=typeof window)t.Interface=e(t.Class);else{var s=require("./Class").Class;t.Interface=e(s)}}("undefined"!=typeof define||"undefined"==typeof window?exports:window),function(){ss2d.ControlEvent=Class({coreId:"*",type:null,data:null,tracking:!0,strict:!1,initialize:function(t,e,s,i){this.type=t,this.data=e,this.tracking=s,this.strict=i}})}(),function(){ss2d.Controller=Class({STATIC:{_controllerMap:[],hasController:function(t,e){var s=ss2d.Controller._controllerMap[e];if(s)for(var i=s.length,r=0;i>r;++r)if(s[r].cid==t)return!0;return!1},removeController:function(t,e){var s=ss2d.Controller._controllerMap[e];if(s)for(var i=s.length,r=0;i>r;++r)if(s[r].cid==t)return s[r].onRemove(),s[r]=null,s.splice(r,1),!0;return!1},removeCore:function(t){var e=ss2d.Controller._controllerMap[t];if(e)for(var s=0;e.length>s;)ss2d.Controller.removeController(e[e.length-1].cid,t);delete ss2d.Controller._controllerMap[t],ss2d.Controller.removeRouter(t)},removeRouter:function(t){var e=ss2d.Controller._controllerMap["*"];if(e)for(var s=e.length,i=0;s>i;--s)e[s-1].coreId==t&&e.splice(s-1,1)},notifyControllers:function(t){var e=ss2d.Controller._controllerMap[t.coreId];if(e)for(var s=0;e.length>s;)e[s].eventType==t.type&&e[s].execute(t),s++}},cid:null,coreId:null,eventType:null,initialize:function(t,e,s){if(this.cid=t,void 0==ss2d.Controller._controllerMap[e.coreId]&&(ss2d.Controller._controllerMap[e.coreId]=[]),"*"!=e.coreId&&ss2d.Controller.hasController(this,e.coreId))throw Error("Controller["+t+"] instance "+'@ "'+e.coreId+'"'+" already constructed !");this.eventType=e.type,this.coreId="*"!=e.coreId?e.coreId:s,ss2d.Controller._controllerMap[e.coreId].push(this),this.onRegister()},sendEvent:function(t){t.strict||ss2d.View.notifyViews(t),ss2d.Controller.notifyControllers(t)},execute:function(){},onRegister:function(){},onRemove:function(){},registerView:function(t,e,s){new e(t,s,this.coreId)},retrieveView:function(t,e){return ss2d.View._retrieveView(t,void 0==e?this.coreId:e)},removeView:function(t,e){ss2d.View._removeView(t,void 0==e?this.coreId:e)},registerController:function(t,e,s){"*"!=s.coreId?new e(t,s):new e(t,s,this.coreId)},removeController:function(t){return ss2d.Controller.removeController(t,this.coreId)},registerModel:function(t,e,s){new e(this.coreId,t,s)},retrieveModel:function(t,e){return ss2d.Model.retrieveModel(t,void 0==e?this.coreId:e)},removeModel:function(t,e){ss2d.Model.removeModel(t,void 0==e?this.coreId:e)}})}(),function(){ss2d.Model=Class({STATIC:{_modelMap:[],retrieveModel:function(t,e){var s=ss2d.Model._modelMap[e];if(s)for(var i=s.length,r=0;i>r;++r)if(s[r].mid==t)return s[r];return null},removeModel:function(t,e){var s=ss2d.Model._modelMap[e];if(s)for(var i=s.length,r=0;i>r;++r)if(s[r].mid==t){s[r].onRemove(),s[r].data=null,s[r]=null,s.splice(r,1);break}},removeCore:function(t){var e=ss2d.Model._modelMap[t];if(e)for(var s=0;e.length>s;)ss2d.Model.removeModel(e[e.length-1].mid,t);delete ss2d.Model._modelMap[t]}},mid:null,coreId:null,data:{},initialize:function(t,e,s){if(void 0==e)throw Error("mid can not undefined!");if(this.mid=e,void 0==ss2d.Model._modelMap[t]&&(ss2d.Model._modelMap[t]=[]),null!=ss2d.Model.retrieveModel(e,t))throw Error("Model["+e+"]"+" instance "+'@ "'+t+'"'+" already constructed !");if(this.coreId=t,null!=s)for(var i in s)this.data[i]=s[i];ss2d.Model._modelMap[t].push(this),this.onRegister()},sendEvent:function(t){ss2d.View.notifyViews(t)},onRegister:function(){},onRemove:function(){},importData:function(t){if(null==t)this.data={};else for(var e in t)this.data[e]=t[e]}})}(),function(){ss2d.View=Class({STATIC:{_viewMap:[],_retrieveView:function(t,e){var s=ss2d.View._viewMap[e];if(s)for(var i=s.length,r=0;i>r;++r)if(s[r].vid==t)return s[r];return null},_removeView:function(t,e){var s=ss2d.View._viewMap[e];if(s)for(var i=s.length,r=0;i>r;++r)if(s[r].vid==t){s[r].onRemove(),s[r].viewComponent=null,s[r].eventList=null,s[r]=null,s.splice(r,1);break}},removeCore:function(t){var e=ss2d.View._viewMap[t];if(e)for(var s=0;e.length>s;)ss2d.View.removeView(e[e.length-1].vid,t);delete ss2d.View._viewMap[t]},notifyViews:function(t){if("*"==t.coreId)throw Error("Model&View不具备模块通信能力!");var e=ss2d.View._viewMap[t.coreId];if(e){for(var s=e.length,i=[],r=0;s>r;++r)for(var a=e[r].eventList.length,n=0;a>n;++n)e[r].eventList[n]==t.type&&i.push(e[r]);for(var o=0;i.length>o;o++)i[o].handleEvent(t)}}},vid:null,coreId:null,viewComponent:null,eventList:[],initialize:function(t,e,s){if(void 0==t)throw Error("vid can not undefined!");if(this.vid=t,void 0==ss2d.View._viewMap[s]&&(ss2d.View._viewMap[s]=[]),null!=ss2d.View._retrieveView(t,s))throw Error("View["+t+"] instance "+'@ "'+s+'"'+" already constructed !");this.coreId=s,this.viewComponent=e,this.eventList=this.listEventInterests(),ss2d.View._viewMap[this.coreId].push(this),this.onRegister()},listEventInterests:function(){return[]},handleEvent:function(){},sendEvent:function(t){t.strict||ss2d.Controller.notifyControllers(t),ss2d.View.notifyViews(t)},onRegister:function(){},onRemove:function(){},registerView:function(t,e,s){new e(t,s,this.coreId)},retrieveView:function(t,e){return ss2d.View._retrieveView(t,void 0==e?this.coreId:e)},retrieveModel:function(t,e){return ss2d.Model.retrieveModel(t,void 0==e?this.coreId:e)}})}(),function(){ss2d.Module=Class({coreId:null,initialize:function(t){this.coreId=t,this.create()},create:function(){},registerModel:function(t,e,s){new e(this.coreId,t,s)},registerView:function(t,e,s){new e(t,s,this.coreId)},registerController:function(t,e,s){"*"!=s.coreId?new e(t,s):new e(t,s,this.coreId)}})}(),function(){ss2d.Event=Class({STATIC:{INITIALIZE:"initialtze",ADDED:"added",REMOVED:"removed",ADDED_TO_STAGE:"added_to_stage",REMOVED_FROM_STAGE:"removed_from_stage",ENTER_FRAME:"enter_frame",COMPLETE:"complete"},type:null,target:null,currentTarget:null,eventPhase:0,bubbles:!1,cancelable:!1,timeStamp:0,defaultPrevented:!1,propagationStopped:!1,immediatePropagationStopped:!1,removed:!1,initialize:function(t,e,s){this.type=t,this.bubbles=e,this.cancelable=s,this.timeStamp=(new Date).getTime()},preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.propagationStopped=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},remove:function(){this.removed=!0},clone:function(){return new ss2d.Event(this.type,this.bubbles,this.cancelable)},toString:function(){return"[events (type="+this.type+")]"}})}(),function(){ss2d.EventDispatcher=Class({STATIC:{initialize:function(t){var e=ss2d.EventDispatcher.prototype;t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent}},_listeners:null,_captureListeners:null,initialize:function(){},addEventListener:function(t,e,s){var i;i=s?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var r=i[t];return r&&this.removeEventListener(t,e,s),r=i[t],r?r.push(e):i[t]=[e],e},removeEventListener:function(t,e,s){var i=s?this._captureListeners:this._listeners;if(i){var r=i[t];if(r)for(var a=0,n=r.length;n>a;a++)if(r[a]==e){1==n?delete i[t]:r.splice(a,1);break}}},removeAllEventListeners:function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},on:function(t,e,s,i,r,a){return e.handleEvent&&(s=s||e,e=e.handleEvent),s=s||this,this.addEventListener(t,function(t){e.call(s,t,r),i&&t.remove()},a)},off:this.removeEventListener,dispatchEvent:function(t,e){if("string"==typeof t){var s=this._listeners;if(!s||!s[t])return!1;t=new ss2d.Event(t)}if(t.target=e||this,t.bubbles&&this.parent){for(var i=this,r=[i];i.parent;)r.push(i=i.parent);var a,n=r.length;for(a=n-1;a>=0&&!t.propagationStopped;a--)r[a]._dispatchEvent(t,1+(0==a));for(a=1;n>a&&!t.propagationStopped;a++)r[a]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},hasEventListener:function(t){var e=this._listeners,s=this._captureListeners;return!!(e&&e[t]||s&&s[t])},toString:function(){return"[EventDispatcher]"},_dispatchEvent:function(t,e){var s,i=1==e?this._captureListeners:this._listeners;if(t&&i){var r=i[t.type];if(!r||!(s=r.length))return;t.currentTarget=this,t.eventPhase=e,t.removed=!1,r=r.slice();for(var a=0;s>a&&!t.immediatePropagationStopped;a++){var n=r[a];n.handleEvent?n.handleEvent(t):n(t),t.removed&&(this.off(t.type,n,1==e),t.removed=!1)}}}})}(),function(){ss2d.MouseEvent=Class({Extends:ss2d.Event,STATIC:{MOUSE_DOWN:"mouse_down",MOUSE_UP:"mouse_up",MOUSE_MOVE:"mouse_move"},stageX:0,stageY:0,initialize:function(t,e,s,i,r){ss2d.MouseEvent.Super.call(this,t,e,s),this.stageX=i,this.stageY=r},clone:function(){return new MouseEvent(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY)},toString:function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"}})}(),function(){ss2d.Timer=Class({Extends:ss2d.EventDispatcher,m_delay:0,m_repeatCount:0,m_interval:null,m_running:!1,m_currentCount:0,initialize:function(t,e){this.m_delay=t,this.m_repeatCount=e||0,this.m_interval=null,this.m_running=!1,this.m_currentCount=0},getRepeatCount:function(){return this.m_repeatCount},getCurrentCount:function(){return this.m_currentCount},getRunning:function(){return this.m_running},reset:function(){this.stop(!0)},start:function(){if(!this.m_running){this.m_running=!0;var t=this;this.m_interval=setInterval(function(){t._iterate()},this.m_delay)}},stop:function(t){this.m_running=!1,t&&(this.m_currentCount=0),this.m_interval&&clearInterval(this.m_interval)},_iterate:function(){this.m_currentCount++,!this.m_repeatCount||this.m_currentCount<=this.m_repeatCount?(this.dispatchEvent(ss2d.TimerEvent.TIMER),this.m_currentCount==this.m_repeatCount&&this.dispatchEvent(ss2d.TimerEvent.TIMER_COMPLETE)):this.stop(!1)}})}(),function(){ss2d.WebGLUtil=Class({STATIC:{GET_A_WEBGL_BROWSER:'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',OTHER_PROBLEM:'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>',makeFailHTML:function(t){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div>"+"</div>"+"</td></tr></table>"},setupWebGL:function(t,e){function s(e){var s=t.parentNode;s&&(s.innerHTML=ss2d.WebGLUtil.makeFailHTML(e))}if(!window.WebGLRenderingContext)return s(ss2d.WebGLUtil.GET_A_WEBGL_BROWSER),null;var i=ss2d.WebGLUtil.create3DContext(t,e);return i||s(ss2d.WebGLUtil.OTHER_PROBLEM),i},create3DContext:function(t,e){var s,i=null;s=["webgl","experimental-webgl","webkit-3d","moz-webgl"];for(var r=0;s.length>r;++r){try{i=t.getContext(s[r],e)}catch(a){}if(i)break}return i}}})}(),function(){ss2d.ClassUtil=Class({STATIC:{construct:function(t,e,s){if(!t)return null;var i;if(s)switch(s.length){case 0:i=new t;break;case 1:i=new t(s[0]);break;case 2:i=new t(s[0],s[1]);break;case 3:i=new t(s[0],s[1],s[2]);break;case 4:i=new t(s[0],s[1],s[2],s[3]);break;case 5:i=new t(s[0],s[1],s[2],s[3],s[4]);break;case 6:i=new t(s[0],s[1],s[2],s[3],s[4],s[5]);break;case 7:i=new t(s[0],s[1],s[2],s[3],s[4],s[5],s[6]);break;case 8:i=new t(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);break;case 9:i=new t(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]);break;case 10:i=new t(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9]);break;default:return null}else i=new t;if(e)for(var r in e)i.hasOwnProperty(r)&&(i[r]=e[r]);return i}}})}(),function(){ss2d.ColorUtil=Class({STATIC:{hexToRGB:function(t){return{r:255&t>>16,g:255&t>>8,b:255&t}},RGBToHex:function(t){return t.r<<16|t.g<<8|t.b}}})}(),function(){ss2d.HitTestUtil=Class({STATIC:{hitTestPoint:function(t,e){var s=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return e.width/2>=s&&e.height/2>=i?!0:!1},hitTestRectangle:function(t,e){var s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return t.width/2+e.width/2>=s&&t.height/2+e.height/2>=i?!0:!1},hitTestRoundness:function(t,e){var s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y),r=Math.sqrt(s*s+i*i);return e.radius>=r?!0:!1},hitTrianglePoint:function(t,e,s){return 0>(e.x-t.x)*(e.y+t.y)+(s.x-e.x)*(s.y+e.y)+(t.x-s.x)*(t.y+s.y)?1:0},hitPoint:function(t,e,s,i){var r=ss2d.HitTestUtil.hitTrianglePoint(t,e,s),a=ss2d.HitTestUtil.hitTrianglePoint(i,e,s),n=ss2d.HitTestUtil.hitTrianglePoint(t,e,i),o=ss2d.HitTestUtil.hitTrianglePoint(t,i,s);return a==r&&n==r&&o==r?!0:!1}}})}(),function(){ss2d.StringUtil=Class({STATIC:{padding:function(t,e,s,i){if(s=void 0===s?" ":s,t+="",t.length>e)return t.substr(0,e);for(;e>t.length;)t=i?s+t:t+s;return t},toBoolean:function(t){return"true"==t||"1"==t||"yes"==t},trim:function(t){var e,s;return e=/^(\s|\n|\r|\t|\v|\f)*/m,s=/(\s|\n|\r|\t|\v\|f)*$/,t.replace(e,"").replace(s,"")},toNative:function(){var t,e=value.toLowerCase();return t="true"==e||"false"==e?ss2d.StringUtil.toBoolean(e):"null"==e||"nan"==e||"undefined"==e||"infinity"==e?null:isNaN(Number(e))?e:ss2d.StringUtil.toNumber(e)},toNumber:function(t){return""==ss2d.StringUtil.trim(t)||null==t?0:Number(t)}}})}(),function(){ss2d.KEY=Class({STATIC:{MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190}}),ss2d.Input=Class({bindings:null,actions:null,presses:null,locks:null,delayedKeyup:null,isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:null,accel:null,initialize:function(){this.bindings={},this.actions={},this.presses={},this.locks={},this.delayedKeyup=[],this.mouse={x:0,y:0},this.accel={x:0,y:0,z:0}},initMouse:function(){this.isUsingMouse||(this.isUsingMouse=!0,window.addEventListener("mousewheel",this.mousewheel.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("mousedown",this.keydown.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("mouseup",this.keyup.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ss2d.Stage2D.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1))},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(t){var e=t.wheel>0?ss2d.KEY.MWHEEL_UP:ss2d.KEY.MWHEEL_DOWN,s=this.bindings[e];s&&(this.actions[s]=!0,this.presses[s]=!0,t.stopPropagation(),this.delayedKeyup.push(s))},mousemove:function(t){for(var e=ss2d.Stage2D.canvas,s={left:0,top:0};null!=e;)s.left+=e.offsetLeft,s.top+=e.offsetTop,e=e.offsetParent;var i=t.pageX,r=t.pageY;t.touches&&(i=t.touches[0].clientX,r=t.touches[0].clientY),this.mouse.x=i-s.left,this.mouse.y=r-s.top},contextmenu:function(t){this.bindings[ss2d.KEY.MOUSE2]&&(t.stopPropagation(),t.preventDefault())},keydown:function(t){if("text"!=t.target.type){var e="keydown"==t.type?t.keyCode:2==t.button?ss2d.KEY.MOUSE2:ss2d.KEY.MOUSE1;("touchstart"==t.type||"mousedown"==t.type)&&this.mousemove(t);var s=this.bindings[e];s&&(this.actions[s]=!0,this.locks[s]||(this.presses[s]=!0,this.locks[s]=!0),t.stopPropagation(),t.preventDefault())}},keyup:function(t){if("text"!=t.target.type){var e="keyup"==t.type?t.keyCode:2==t.button?ss2d.KEY.MOUSE2:ss2d.KEY.MOUSE1,s=this.bindings[e];s&&(this.delayedKeyup.push(s),t.stopPropagation(),t.preventDefault())}},devicemotion:function(t){this.accel=t.accelerationIncludingGravity},bind:function(t,e){ss2d.log("Input -> bind() -> key:"+t+", action:"+e),0>t?this.initMouse():t>0&&this.initKeyboard(),this.bindings[t]=e},bindTouch:function(t,e){var s=ss2d.$(t),i=this;s.addEventListener("touchstart",function(t){i.touchStart(t,e)},!1),s.addEventListener("touchend",function(t){i.touchEnd(t,e)},!1)},unbind:function(t){this.bindings[t]=null},unbindAll:function(){this.bindings=[]},state:function(t){return this.actions[t]},pressed:function(t){return this.presses[t]},clearPressed:function(){for(var t=0;this.delayedKeyup.length>t;t++){var e=this.delayedKeyup[t];this.actions[e]=!1,this.locks[e]=!1}this.delayedKeyup=[],this.presses={}},touchStart:function(t,e){return this.actions[e]=!0,this.presses[e]=!0,t.stopPropagation(),t.preventDefault(),!1},touchEnd:function(t,e){return this.delayedKeyup.push(e),t.stopPropagation(),t.preventDefault(),!1}})}(),function(){ss2d.Capabilities=Class({STATIC:{pixelRatio:window.devicePixelRatio||1,viewport:{width:window.innerWidth,height:window.innerHeight},screen:{width:window.screen.availWidth*this.pixelRatio,height:window.screen.availHeight*this.pixelRatio},iPhone:/iPhone/i.test(navigator.userAgent),iPhone4:this.iPhone&&2==this.pixelRatio,iPad:/iPad/i.test(navigator.userAgent),android:/android/i.test(navigator.userAgent),iOS:this.iPhone||this.iPad,mobile:this.iOS||this.android}})}(),function(){ss2d.FrameFunction=Class({frame:0,callback:null,initialize:function(t,e){t&&(this.frame=t),e&&(this.callback=e)}})}(),function(){ss2d.ColorTransform=Class({redMultiplier:1,greenMultiplier:1,blueMultiplier:1,alphaMultiplier:1,redOffset:0,greenOffset:0,blueOffset:0,alphaOffset:0,initialize:function(t,e,s,i,r,a,n,o){this.redMultiplier=void 0==t?1:t,this.greenMultiplier=void 0==e?1:e,this.blueMultiplier=void 0==s?1:s,this.alphaMultiplier=void 0==i?1:i,this.redOffset=r||0,this.greenOffset=a||0,this.blueOffset=n||0,this.alphaOffset=o||0}})}(),function(){ss2d.Matrix2D=Class({rawData:null,spinArray:null,translationArray:null,matrix3x3:null,PI:Math.PI/180,initialize:function(){this.identity()},identity:function(){this.rawData=new Float32Array(8),this.spinArray=new Float32Array(8),this.translationArray=new Float32Array(8),this.matrix3x3=new Float32Array(8)},add3x32:function(t,e,s){t[0]=e[0]*s[0]+e[1]*s[3],t[1]=e[0]*s[1]+e[1]*s[4],t[3]=e[3]*s[0]+e[4]*s[3],t[4]=e[3]*s[1]+e[4]*s[4],t[6]=e[6]*s[0]+e[7]*s[3]+s[6],t[7]=e[6]*s[1]+e[7]*s[4]+s[7]},add3x3:function(t,e){return this.matrix3x3=new Float32Array(8),this.matrix3x3[0]=t[0]*e[0]+t[1]*e[3],this.matrix3x3[1]=t[0]*e[1]+t[1]*e[4],this.matrix3x3[3]=t[3]*e[0]+t[4]*e[3],this.matrix3x3[4]=t[3]*e[1]+t[4]*e[4],this.matrix3x3[6]=t[6]*e[0]+t[7]*e[3]+e[6],this.matrix3x3[7]=t[6]*e[1]+t[7]*e[4]+e[7],this.matrix3x3},add1x32:function(t,e,s){t[0]=e[0]*s[0]+e[1]*s[3]+s[6],t[1]=e[0]*s[1]+e[1]*s[4]+s[7]},add1x3:function(t,e){var s=new Float32Array(3);return s[0]=t[0]*e[0]+t[1]*e[3]+e[6],s[1]=t[0]*e[1]+t[1]*e[4]+e[7],s},appendRotation:function(t,e,s){var i=Math.cos(t*this.PI),r=Math.sin(t*this.PI);this.spinArray[0]=i,this.spinArray[1]=r,this.spinArray[2]=0,this.spinArray[3]=-r,this.spinArray[4]=i,this.spinArray[5]=0,this.spinArray[6]=e,this.spinArray[7]=s,this.spinArray[8]=1},appendTranslation:function(t,e,s,i){this.translationArray[0]=t,this.translationArray[1]=i,this.translationArray[2]=0,this.translationArray[3]=s,this.translationArray[4]=e,this.translationArray[5]=0,this.translationArray[6]=0,this.translationArray[7]=0,this.translationArray[8]=1},upDateMatrix:function(t,e,s,i,r,a,n){var o=t*this.PI,h=Math.cos(o),u=Math.sin(o);this.rawData[0]=i*h+n*-u,this.rawData[1]=i*u+n*h,this.rawData[3]=a*h+r*-u,this.rawData[4]=a*u+r*h,this.rawData[6]=e,this.rawData[7]=s}})}(),function(){ss2d.Matrix3D=Class({rawData:[],spinArray:[],translationArray:[],matrix4x4:[],PI:Math.PI/180,identity:function(){this.rawData=new Float32Array(16),this.spinArray=new Float32Array(16),this.translationArray=new Float32Array(16),this.matrix4x4=new Float32Array(16)},add4x4:function(t,e){var s=new Float32Array(16);return s[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],s[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],s[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],s[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],s[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],s[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],s[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],s[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],s[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],s[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],s[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],s[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],s[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],s[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],s[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],s[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],s},add1x4:function(t,e){var s=new Float32Array(4);return s[0]=t[0]*e[0]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],s[1]=t[0]*e[1]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],s[2]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],s[4]=t[0]*e[4]+t[1]*e[8]+t[2]*e[12]+t[3]*e[16],s},appendRotation:function(t,e,s){var i=Math.cos(t*this.PI),r=Math.sin(t*this.PI);this.spinArray[0]=i,this.spinArray[1]=r,this.spinArray[2]=0,this.spinArray[3]=0,this.spinArray[4]=-r,this.spinArray[5]=i,this.spinArray[6]=0,this.spinArray[7]=0,this.spinArray[8]=e,this.spinArray[9]=s,this.spinArray[10]=1,this.spinArray[11]=0,this.spinArray[12]=0,this.spinArray[13]=0,this.spinArray[14]=0,this.spinArray[15]=1},appendTranslation:function(t,e,s,i){this.translationArray[0]=t,this.translationArray[1]=i,this.translationArray[2]=0,this.translationArray[3]=0,this.translationArray[4]=s,this.translationArray[5]=e,this.translationArray[6]=0,this.translationArray[7]=0,this.translationArray[8]=0,this.translationArray[9]=0,this.translationArray[10]=1,this.translationArray[11]=0,this.translationArray[12]=0,this.translationArray[13]=0,this.translationArray[14]=0,this.translationArray[15]=1},upDateMatrix:function(t,e,s,i,r,a,n){this.appendRotation(t,e,s),this.appendTranslation(i,r,a,n),this.rawData=this.add4x4(this.spinArray,this.translationArray)}})}(),function(){ss2d.Point=Class({STATIC:{distance:function(t,e){var s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)},interpolate:function(t,e,s){var i=new ss2d.Point(0,0);return i.x=t.x+s*(e.x-t.x),i.y=t.y+s*(e.y-t.y),i},polar:function(t,e){return new ss2d.Point(t*Math.cos(e),t*Math.sin(e))}},x:0,y:0,initialize:function(t,e){void 0==t&&(t=0),void 0==e&&(e=0),this.x=t,this.y=e,Object.defineProperty?Object.defineProperty(this,"length",{get:this._get_length}):this.__defineGetter__&&this.__defineGetter__("length",this._get_length)},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},add:function(t){return new ss2d.Point(this.x+t.x,this.y+t.y)},clone:function(){return new ss2d.Point(this.x,this.y)},equals:function(t){return this.x==t.x&&this.y==t.y},normalize:function(t){var e=t/this.length;this.x*=e,this.y*=e},offset:function(t,e){this.x+=t,this.y+=e},subtract:function(t){return new ss2d.Point(this.x-t.x,this.y-t.y)}})}(),function(){ss2d.QuadMatrixUtil=Class({matrix2D:null,m_x:0,m_y:0,m_rotation:0,m_scaleX:1,m_scaleY:1,m_skewX:0,m_skewY:0,m_pivotX:0,m_pivotY:0,ids:0,itemList:null,itemDataList:null,itemDataAgencyList:null,initialize:function(){this.matrix2D=new ss2d.Matrix2D,this.itemList=[],this.itemDataList=[],this.itemDataAgencyList=[]},setPoint:function(t,e){this.itemDataList[t]=e},getPoint:function(t){return this.itemDataList[t]},upDateFrame:function(t){this.itemDataList[this.ids]=new ss2d.Point(0,0),this.itemDataList[this.ids].x=t.x,this.itemDataList[this.ids].y=t.y,this.itemDataAgencyList[this.ids]=new ss2d.Point(0,0),this.itemDataAgencyList[this.ids].x=t.x,this.itemDataAgencyList[this.ids].y=t.y},upDateRaw:function(){for(var t=0;this.ids>t;t++)this.itemList[t].x=this.itemDataAgencyList[t].x*this.matrix2D.rawData[0]+this.itemDataAgencyList[t].y*this.matrix2D.rawData[3]+this.matrix2D.rawData[6],this.itemList[t].y=this.itemDataAgencyList[t].x*this.matrix2D.rawData[1]+this.itemDataAgencyList[t].y*this.matrix2D.rawData[4]+this.matrix2D.rawData[7]},upDateMatrix:function(t){var e=this.m_rotation*this.matrix2D.PI,s=Math.cos(e),i=Math.sin(e);if(this.matrix2D.rawData[0]=this.m_scaleX*s+this.m_skewY*-i,this.matrix2D.rawData[1]=this.m_scaleX*i+this.m_skewY*s,this.matrix2D.rawData[3]=this.m_skewX*s+this.m_scaleY*-i,this.matrix2D.rawData[4]=this.m_skewX*i+this.m_scaleY*s,this.matrix2D.rawData[6]=this.m_x+this.m_pivotX,this.matrix2D.rawData[7]=this.m_y+this.m_pivotY,t)for(var r=0;this.ids>r;r++)this.itemList[r].x=this.itemDataAgencyList[r].x*this.matrix2D.rawData[0]+this.itemDataAgencyList[r].y*this.matrix2D.rawData[3]+this.matrix2D.rawData[6],this.itemList[r].y=this.itemDataAgencyList[r].x*this.matrix2D.rawData[1]+this.itemDataAgencyList[r].y*this.matrix2D.rawData[4]+this.matrix2D.rawData[7]
},upDateMatrixData:function(t,e,s,i,r,a){for(var n=0;this.ids>n;n++)this.itemDataAgencyList[n].x=this.itemDataList[n].x*s+this.itemDataList[n].y*r+t,this.itemDataAgencyList[n].y=this.itemDataList[n].x*a+this.itemDataList[n].y*i+e},addItem:function(t){this.itemList[this.ids]=t,this.upDateFrame(t),this.ids++},clear:function(){this.ids=0,this.m_x=0,this.m_y=0,this.m_rotation=0,this.m_scaleX=1,this.m_scaleY=1,this.m_skewX=0,this.m_skewY=0,this.m_pivotX=0,this.m_pivotY=0;for(var t=0;this.itemDataList.length>t;t++)this.itemDataList[t]=null;this.itemDataList=[];for(var e=0;this.itemDataAgencyList.length>e;e++)this.itemDataAgencyList[e]=null;this.itemDataAgencyList=[];for(var s=0;this.itemList.length>s;s++)this.itemList[s]=null;this.itemList=[]},getX:function(){return this.m_x},setX:function(t){this.m_x=t},getY:function(){return this.m_y},setY:function(t){this.m_y=t},getScaleX:function(){return this.m_scaleX},setScaleX:function(t){this.m_scaleX=t},getScaleY:function(){return this.m_scaleY},setScaleY:function(t){this.m_scaleY=t},getSkewX:function(){return this.m_skewX},setSkewX:function(t){this.m_skewX=t},getSkewY:function(){return this.m_skewY},setSkewY:function(t){this.m_skewY=t},getPivotX:function(){return this.m_pivotX},setPivotX:function(t){this.m_pivotX=t},getPivotY:function(){return this.m_pivotY},setPivotY:function(t){this.m_pivotY=t},getRotation:function(){return this.m_rotation},setRotation:function(t){this.m_rotation=t},getMatrix2D:function(){return this.matrix2D},setMatrix2D:function(t){this.matrix2D=t}})}(),function(){ss2d.Rectangle=Class({x:0,y:0,width:0,height:0,initialize:function(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i},clone:function(){return new ss2d.Rectangle(this.x,this.y,this.width,this.height)},contains:function(t,e){return t>this.left&&this.right>t&&e>this.top&&this.bottom>e},containsPoint:function(t){return this.contains(t.x,t.y)},containsRect:function(t){return this.containsPoint(t.topLeft)&&this.containsPoint(t.bottomRight)},equals:function(t){return t.topLeft.equals(this.topLeft)&&t.bottomRight.equals(this.bottomRight)},inflate:function(t,e){this.width+=t,this.height+=e},inflatePoint:function(t){this.inflate(t.width,t.height)},intersection:function(t){if(this.intersects(t)){var e=Math.max(this.top,t.top),s=Math.max(this.left,t.left),i=Math.min(this.bottom,t.bottom),r=Math.min(this.right,t.right);return new ss2d.Rectangle(s,e,r-s,i-e)}return null},intersects:function(t){return this.containsPoint(t.topLeft)||this.containsPoint(t.topRight)||this.containsPoint(t.bottomLeft)||this.containsPoint(t.bottomRight)},isEmpty:function(){return 0==this.x&&0==this.y&&0==this.width&&0==this.height},offset:function(t,e){this.x+=t,this.y+=e},offsetPoint:function(t){this.offset(t.x,t.y)},setEmpty:function(){this.x=this.y=this.width=this.height=0},union:function(t){var e=Math.min(this.top,t.top),s=Math.min(this.left,t.left),i=Math.max(this.bottom,t.bottom),r=Math.max(this.right,t.right);return new ss2d.Rectangle(s,e,r-s,i-e)}})}(),function(){ss2d.Group=Class({Extends:ss2d.EventDispatcher,_x:0,_y:0,m_scaleX:1,m_scaleY:1,m_skewX:0,m_skewY:0,m_parent:null,m_rotation:0,parentGroup:null,childGroup:null,matrix2D:null,rawData:null,_quadList:null,initialize:function(){this.rawData=new Float32Array(8),this.matrix2D=new ss2d.Matrix2D,this._quadList=[],ss2d[this.upData]=this.upData.bind(this),ss2d.stage.addEventListener(ss2d.Event.ENTER_FRAME,ss2d[this.upData])},clearParentGroup:function(){this.parentGroup.childGroup=null,this.parentGroup=null},containsGroup:function(t){for(;t;){if(t==this)return!0;t=t.parentGroup}return!1},addChild:function(t){t.setTransform(this.matrix2D),this._quadList.push(t),ss2d[this.upData]()},removeChild:function(t){var e=this._quadList.indexOf(t);-1!=e&&this._quadList.splice(e,1)},upRedraw:function(){this.isRedraw=!0},upData:function(){this.matrix2D.upDateMatrix(this.m_rotation,2*1*this._x/ss2d.Stage2D.stageHeight,2*1*this._y/ss2d.Stage2D.stageHeight,this.m_scaleX,this.m_scaleY,this.m_skewX,this.m_skewY),null!=this.parentGroup&&(this.matrix2D.rawData=this.parentGroup.matrix2D.add3x3(this.matrix2D.rawData,this.parentGroup.matrix2D.rawData));for(var t=0;this._quadList.length>t;t++)this._quadList[t].isRedraw=!0;null!=this.childGroup&&this.childGroup.upRedraw()},dispose:function(){ss2d.stage.removeEventListener(ss2d.Event.ENTER_FRAME,ss2d[this.upData]),ss2d[this.upData]=null;for(var t=0;this._quadList.length>t;t++)this.removeChild(this._quadList[t]);this._quadList=null,this.m_parent=null,this.parentGroup=null,this.childGroup=null,this.matrix2D=null,this.rawData=null},getX:function(){return this._x},setX:function(t){this._x=t},getY:function(){return this._y},setY:function(t){this._y=t},getScaleX:function(){return this.m_scaleX},setScaleX:function(t){this.m_scaleX=t},getScaleY:function(){return this.m_scaleY},setScaleY:function(t){this.m_scaleY=t},getSkewX:function(){return this.m_skewX},setSkewX:function(t){this.m_skewX=t},getSkewY:function(){return this.m_skewY},setSkewY:function(t){this.m_skewY=t},getRotation:function(){return this.m_rotation},setRotation:function(t){this.m_rotation=t},setParentGroup:function(t){this.parentGroup=t,this.parentGroup.childGroup=this,ss2d[this.upData]()}})}(),function(){ss2d.Blend=Class({STATIC:{BLEND_NONE:[1,0],BLEND_ADD:[770,770],BLEND_NORMAL:[770,771],BLEND_MULTIPLY:[774,771],BLEND_SCREEN:[770,1],BLEND_ERASE:[0,771],BLEND_EXCLUSION:[769,769],BLEND_LIGHT:[774,772],BLEND_FUSE:[772,768],BLEND_MASK:[774,771],BLEND_ADD_ALPHA:[770,772]}})}(),function(){ss2d.DisplayObject=Class({Extends:ss2d.EventDispatcher,x:0,y:0,m_rotation:0,m_alpha:1,m_visible:!0,isRedraw:!0,m_parent:null,m_mouseEnabled:!1,m_userData:null,m_center:!1,m_forceCenter:!1,m_r:1,m_g:1,m_b:1,m_a:1,m_width:1,m_height:1,m_scaleX:1,m_scaleY:1,m_skewX:0,m_skewY:0,m_pivotX:0,m_pivotY:0,GPUX:0,GPUY:0,GPU:!1,initialize:function(){},getColor:function(){return ss2d.ColorUtil.RGBToHex({r:255*this.m_r,g:255*this.m_g,b:255*this.m_b})},setColor:function(t){var e=ss2d.ColorUtil.hexToRGB(t);this.setR(e.r/255),this.setB(e.b/255),this.setG(e.g/255)},getR:function(){return this.m_r},setR:function(t){this.m_r=t,this.isRedraw=!0},getG:function(){return this.m_g},setG:function(t){this.m_g=t,this.isRedraw=!0},getB:function(){return this.m_b},setB:function(t){this.m_b=t,this.isRedraw=!0},getA:function(){return this.m_a},setA:function(t){this.m_a=t,this.isRedraw=!0},getX:function(){return this.x},setX:function(t){this.x=t,this.isRedraw=!0},getY:function(){return this.y},setY:function(t){this.y=t,this.isRedraw=!0},getWidth:function(){return this.m_width},setWidth:function(t){this.m_width=t,this.isRedraw=!0},getHeight:function(){return this.m_height},setHeight:function(t){this.m_height=t,this.isRedraw=!0},getScaleX:function(){return this.m_scaleX},setScaleX:function(t){this.m_scaleX=t,this.isRedraw=!0},getScaleY:function(){return this.m_scaleY},setScaleY:function(t){this.m_scaleY=t,this.isRedraw=!0},getSkewX:function(){return this.m_skewX},setSkewX:function(t){this.m_skewX=t,this.isRedraw=!0},getSkewY:function(){return this.m_skewY},setSkewY:function(t){this.m_skewY=t,this.isRedraw=!0},getPivotX:function(){return this.m_pivotX},setPivotX:function(t){this.m_pivotX=t,this.isRedraw=!0},getPivotY:function(){return this.m_pivotY},setPivotY:function(t){this.m_pivotY=t,this.isRedraw=!0},getRotation:function(){return this.m_rotation},setRotation:function(t){this.m_rotation=t,this.isRedraw=!0},getAlpha:function(){return this.m_alpha},setAlpha:function(t){this.m_alpha=t,this.isRedraw=!0},getVisible:function(){return this.m_visible},setVisible:function(t){this.m_visible=t,this.isRedraw=!0},getIsRedraw:function(){return this.isRedraw},setIsRedraw:function(t){this.isRedraw=t},getParent:function(){return this.m_parent},setParent:function(t){this.m_parent=t},getMouseEnabled:function(){return this.m_mouseEnabled},setMouseEnabled:function(t){this.m_mouseEnabled=t},getUserData:function(){return this.m_userData},setUserData:function(t){this.m_userData=t},getCenter:function(){return this.m_center},setCenter:function(t){this.m_center=t},getForceCenter:function(){return this.m_forceCenter},setForceCenter:function(t){this.m_forceCenter=t},hitTestPoint:function(t,e){var s=this.absCentre(),i=Math.abs(s.x-t),r=Math.abs(s.y-e);return this.getWidth()/2>=i&&this.getHeight()/2>=r?!0:!1},hitTestObject:function(t){var e=this.absCentre(),s=t.absCentre(),i=Math.abs(e.x-s.x),r=Math.abs(e.y-s.y);return this.getWidth()/2+this.getWidth()/2>=i&&t.getHeight()/2+t.getHeight()/2>=r?!0:!1},hitTestRoundness:function(t,e,s){var i=this.absCentre(),r=Math.abs(i.x-t),a=Math.abs(i.y-e),n=Math.sqrt(r*r+a*a);return s>=n?!0:!1}})}(),function(){ss2d.FrameBuffer=Class({_frameBuff:null,_sceneList:null,_clear:!0,initialize:function(){this._sceneList=[]},setDisplay:function(t){this._frameBuff=t},getFrameBuff:function(){return this._frameBuff},isClear:function(t){this._clear=t},addChild:function(t){this._sceneList.push(t)},removeChild:function(t){var e=this._sceneList.indexOf(t);-1!=e&&this._sceneList.splice(e,1)},paint:function(){for(var t=0;this._sceneList.length>t;t++)this._sceneList[t].paint()}})}(),function(){ss2d.Scene=Class({Extends:ss2d.EventDispatcher,glScissorX:0,glScissorY:0,glScissorWidth:0,glScissorHeight:0,stage:null,verticesColorBuffer:null,verticesGPUBuffer:null,verticesJointBuffer:null,vertexPositionBuffer:null,vertexTextureUvdBuffer:null,vertexIndexBuffer:null,quadList:null,maxQuadNum:1,m_isJoint:!1,m_indexList:null,m_verticesGPUList:null,m_jointList:null,m_verticesList:null,m_uvList:null,m_colorList:null,m_texture:null,shader:null,m_sfactor:null,m_dfactor:null,m_mouseEnabled:!0,m_applyIndex:0,initialize:function(){this.glScissorX=0,this.glScissorY=0,this.glScissorWidth=ss2d.Stage2D.canvas.width,this.glScissorHeight=ss2d.Stage2D.canvas.height,this.quadList=[],this.maxQuadNum=1,arguments.length>1&&(this.maxQuadNum=arguments[1]),this.m_indexList=new Uint16Array(6*this.maxQuadNum),this.m_jointList=new Float32Array(8*this.maxQuadNum),this.m_verticesGPUList=new Float32Array(8*this.maxQuadNum),this.m_verticesList=new Float32Array(8*this.maxQuadNum),this.m_uvList=new Float32Array(8*this.maxQuadNum),this.m_colorList=new Float32Array(16*this.maxQuadNum),this.m_texture=arguments[0],arguments[0]instanceof Array?(this.m_isJoint=!0,this.shader=new ss2d.ShaderJoint):this.shader=ss2d.Stage2D.shader,this.m_sfactor=ss2d.Stage2D.gl.ONE,this.m_dfactor=ss2d.Stage2D.gl.ONE_MINUS_SRC_ALPHA;for(var t=0;this.maxQuadNum>t;t++)this.quadList.push(new ss2d.Quad(t,this.m_texture,this.m_verticesList,this.m_uvList,this.m_colorList,this.m_jointList,this.m_indexList,this.m_verticesGPUList));this.verticesGPUBuffer=ss2d.Stage2D.gl.createBuffer(),this.verticesJointBuffer=ss2d.Stage2D.gl.createBuffer(),this.verticesColorBuffer=ss2d.Stage2D.gl.createBuffer(),this.vertexPositionBuffer=ss2d.Stage2D.gl.createBuffer(),this.vertexTextureUvdBuffer=ss2d.Stage2D.gl.createBuffer(),this.vertexIndexBuffer=ss2d.Stage2D.gl.createBuffer()},dispose:function(){ss2d.Stage2D.gl.deleteBuffer(this.verticesGPUBuffer),ss2d.Stage2D.gl.deleteBuffer(this.verticesJointBuffer),ss2d.Stage2D.gl.deleteBuffer(this.verticesColorBuffer),ss2d.Stage2D.gl.deleteBuffer(this.vertexPositionBuffer),ss2d.Stage2D.gl.deleteBuffer(this.vertexTextureUvdBuffer),ss2d.Stage2D.gl.deleteBuffer(this.vertexIndexBuffer),this.verticesGPUBuffer=null,this.verticesJointBuffer=null,this.verticesColorBuffer=null,this.vertexPositionBuffer=null,this.vertexTextureUvdBuffer=null,this.vertexIndexBuffer=null,this.m_texture=null},applyQuad:function(t){if(t){for(var e=this.m_applyIndex;this.quadList.length>e;e++)if(0==this.quadList[e].getIsActivate())return this.m_applyIndex=e,this.quadList[e].launch(),this.quadList[e].setScene(this),this.quadList[e]}else for(var e=0;this.quadList.length>e;e++)if(0==this.quadList[e].getIsActivate())return this.quadList[e].launch(),this.quadList[e].setScene(this),this.quadList[e];return null},hideQuad:function(t){t.setScene(null)},showQuad:function(t,e){if(!e){var s=this.quadList.indexOf(t);if(-1!=s){for(var i=s+1;this.quadList.length>i;i++){var r=this.quadList[i];r.id=r.id-1,r.initIndexs()}t.id=this.quadList.length-1,this.quadList.splice(s,1),this.quadList.push(t),t.initIndexs()}}t.setScene(this)},setTexture:function(t){this.m_texture=t},getTexture:function(){return this.m_texture},getMouseEnabled:function(){return this.m_mouseEnabled},setMouseEnabled:function(t){this.m_mouseEnabled=t},setShader:function(t){this.shader=null!=t?t:ss2d.Stage2D.shader},getShader:function(){return this.shader},blend:function(){2==arguments.length?(this.m_sfactor=arguments[0],this.m_dfactor=arguments[1]):1==arguments.length&&(this.m_sfactor=arguments[0][0],this.m_dfactor=arguments[0][1])},getQuadsUnderPoint:function(t,e){for(var s=null,i=this.quadList.length-1;i>=0;i--)if(this.quadList[i].getMouseEnabled()&&null!=this.quadList[i].getScene()&&this.quadList[i].getVisible()&&0!=this.quadList[i].getWidth()&&0!=this.quadList[i].getHeight()){var r=new ss2d.Point(2*(t-this.quadList[i].GPUX)/ss2d.Stage2D.stageHeight,2*(e-this.quadList[i].GPUY)/ss2d.Stage2D.stageHeight);(ss2d.hitPoint(this.quadList[i].getVertex(0),this.quadList[i].getVertex(1),this.quadList[i].getVertex(2),r)||ss2d.hitPoint(this.quadList[i].getVertex(2),this.quadList[i].getVertex(1),this.quadList[i].getVertex(3),r))&&(null==s&&(s=[]),s.push(this.quadList[i]))}return s},hitTestPoint:function(t,e){for(var s=this.quadList.length-1;s>=0;s--)if(this.quadList[s].mouseEnabled&&null!=this.quadList[s].parent&&this.quadList[s].m_visible){var i=(this.quadList[s].getVertex(3)[0]-this.quadList[s].getVertex(0)[0])/2,r=(this.quadList[s].getVertex(3)[1]-this.quadList[s].getVertex(0)[1])/2,a=this.quadList[s].getVertex(0)[0]+i,n=this.quadList[s].getVertex(0)[1]+r;if(0!=this.quadList[s].width&&0!=this.quadList[s].height&&i>=Math.abs(t-a)&&r>=Math.abs(e-n))return this.quadList[s]}return null},paint:function(){ss2d.Stage2D.gl.scissor(this.glScissorX,this.glScissorY,this.glScissorWidth,this.glScissorHeight),ss2d.Stage2D.gl.blendFunc(this.m_sfactor,this.m_dfactor);for(var t=this.quadList.length,e=0;t>e;e++){var s=this.quadList[e];if(null!=s.scene&&s.m_visible&&s.m_isActivate)if(s.m_isPlaying&&(s.m_targetTime=(new Date).getTime(),s.m_targetTime-s.m_lastTime>=s.m_delay&&(s.m_lastTime=s.m_targetTime,s.updateFrame(!0))),s.isRedraw&&(s.isRedraw=!1,s.m_quadMatrixUtil.setX(2*s.x/ss2d.Stage2D.stageHeight),s.m_quadMatrixUtil.setY(2*s.y/ss2d.Stage2D.stageHeight),s.m_quadMatrixUtil.setRotation(s.m_rotation),s.m_quadMatrixUtil.upDateMatrixData(2*(-s.m_pivotX+s.m_framePivotX)*s.m_scaleX/ss2d.Stage2D.stageHeight,2*(-s.m_pivotY+s.m_framePivotY)*s.m_scaleY/ss2d.Stage2D.stageHeight,s.m_scaleX*(s.m_frameWidth/s.m_Texture.width),s.m_scaleY*(s.m_frameHeight/s.m_Texture.height),s.m_skewX,s.m_skewY),s.m_quadMatrixUtil.upDateMatrix(null==s.m_transform),null!=s.m_transform&&(s.m_quadMatrixUtil.getMatrix2D().rawData=s.m_quadMatrixUtil.getMatrix2D().add3x3(s.m_quadMatrixUtil.getMatrix2D().rawData,s.m_transform.rawData),s.m_quadMatrixUtil.upDateRaw()),s.frameXDivWidth=s.m_frameX/s.m_Texture.width,s.frameYDivHeight=s.m_frameY/s.m_Texture.height,s.frameWidthDivWidth=s.m_frameWidth/s.m_Texture.width,s.frameHeightDivHeight=s.m_frameHeight/s.m_Texture.height,s.textureUV[s.id8_1]=s.frameXDivWidth,s.textureUV[s.id8_2]=-s.frameYDivHeight,s.textureUV[s.id8_3]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_4]=-s.frameYDivHeight,s.textureUV[s.id8_5]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_6]=-s.frameHeightDivHeight-s.frameYDivHeight,s.textureUV[s.id8_7]=s.frameXDivWidth,s.textureUV[s.id8_8]=-s.frameHeightDivHeight-s.frameYDivHeight),s.isAnimationMatrix||(s.frameXDivWidth=s.m_frameX/s.m_Texture.width,s.frameYDivHeight=s.m_frameY/s.m_Texture.height,s.frameWidthDivWidth=s.m_frameWidth/s.m_Texture.width,s.frameHeightDivHeight=s.m_frameHeight/s.m_Texture.height,s.textureUV[s.id8_1]=s.frameXDivWidth,s.textureUV[s.id8_2]=-s.frameYDivHeight,s.textureUV[s.id8_3]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_4]=-s.frameYDivHeight,s.textureUV[s.id8_5]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_6]=-s.frameHeightDivHeight-s.frameYDivHeight,s.textureUV[s.id8_7]=s.frameXDivWidth,s.textureUV[s.id8_8]=-s.frameHeightDivHeight-s.frameYDivHeight),s.GPU&&(s.verticesGPUList[s.id8_1]=2*s.GPUX/ss2d.Stage2D.stageHeight,s.verticesGPUList[s.id8_2]=2*s.GPUY/ss2d.Stage2D.stageHeight,s.verticesGPUList[s.id8_3]=s.verticesGPUList[s.id8_1],s.verticesGPUList[s.id8_4]=s.verticesGPUList[s.id8_2],s.verticesGPUList[s.id8_5]=s.verticesGPUList[s.id8_1],s.verticesGPUList[s.id8_6]=s.verticesGPUList[s.id8_2],s.verticesGPUList[s.id8_7]=s.verticesGPUList[s.id8_1],s.verticesGPUList[s.id8_8]=s.verticesGPUList[s.id8_2]),s.vertices[s.id8_1]=s.leftUpPoint.x,s.vertices[s.id8_2]=s.leftUpPoint.y,s.vertices[s.id8_3]=s.rightUpPoint.x,s.vertices[s.id8_4]=s.rightUpPoint.y,s.vertices[s.id8_5]=s.rightDownPoint.x,s.vertices[s.id8_6]=s.rightDownPoint.y,s.vertices[s.id8_7]=s.leftDownPoint.x,s.vertices[s.id8_8]=s.leftDownPoint.y,s.jointList[s.id8_1]=s.m_textureID,s.jointList[s.id8_2]=s.m_textureID,s.jointList[s.id8_3]=s.m_textureID,s.jointList[s.id8_4]=s.m_textureID,s.jointList[s.id8_5]=s.m_textureID,s.jointList[s.id8_6]=s.m_textureID,s.jointList[s.id8_7]=s.m_textureID,s.jointList[s.id8_8]=s.m_textureID,s.isVertexColour){var i=s.m_r*s.m_alpha,r=s.m_g*s.m_alpha,a=s.m_b*s.m_alpha,n=s.m_a*s.m_alpha;s.verticesColor[s.id16_1]=i*s.m_leftUpR,s.verticesColor[s.id16_2]=r*s.m_leftUpG,s.verticesColor[s.id16_3]=a*s.m_leftUpB,s.verticesColor[s.id16_4]=n*s.m_leftUpA,s.verticesColor[s.id16_5]=i*s.m_rightUpR,s.verticesColor[s.id16_6]=r*s.m_rightUpG,s.verticesColor[s.id16_7]=a*s.m_rightUpB,s.verticesColor[s.id16_8]=n*s.m_rightUpA,s.verticesColor[s.id16_9]=i*s.m_rightDownR,s.verticesColor[s.id16_10]=r*s.m_rightDownG,s.verticesColor[s.id16_11]=a*s.m_rightDownB,s.verticesColor[s.id16_12]=n*s.m_rightDownA,s.verticesColor[s.id16_13]=i*s.m_leftDownR,s.verticesColor[s.id16_14]=r*s.m_leftDownG,s.verticesColor[s.id16_15]=a*s.m_leftDownB,s.verticesColor[s.id16_16]=n*s.m_leftDownA}else s.verticesColor[s.id16_1]=1,s.verticesColor[s.id16_2]=1,s.verticesColor[s.id16_3]=1,s.verticesColor[s.id16_4]=1,s.verticesColor[s.id16_5]=1,s.verticesColor[s.id16_6]=1,s.verticesColor[s.id16_7]=1,s.verticesColor[s.id16_8]=1,s.verticesColor[s.id16_9]=1,s.verticesColor[s.id16_10]=1,s.verticesColor[s.id16_11]=1,s.verticesColor[s.id16_12]=1,s.verticesColor[s.id16_13]=1,s.verticesColor[s.id16_14]=1,s.verticesColor[s.id16_15]=1,s.verticesColor[s.id16_16]=1;else s.vertices[s.id8_1]=0,s.vertices[s.id8_2]=0,s.vertices[s.id8_3]=0,s.vertices[s.id8_4]=0,s.vertices[s.id8_5]=0,s.vertices[s.id8_6]=0,s.vertices[s.id8_7]=0,s.vertices[s.id8_8]=0;s.dispatchEvent(ss2d.Event.ENTER_FRAME)}this.shader.upDataShader(this),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),ss2d.Stage2D.gl.drawElements(ss2d.Stage2D.gl.TRIANGLES,6*this.maxQuadNum,ss2d.Stage2D.gl.UNSIGNED_SHORT,0)}})}(),function(){ss2d.Sprite=Class({Extends:ss2d.Scene,m_width:1,m_height:1,m_scaleX:1,m_scaleY:1,m_skewX:0,m_skewY:0,m_pivotX:0,m_pivotY:0,m_rotation:0,m_visible:!0,m_parent:null,m_mouseEnabled:!1,m_userData:null,m_center:!1,m_forceCenter:!1,m_quad:null,m_displayerlist:null,group:null,initialize:function(){this.init()},init:function(){this.m_displayerlist=[],this.group=new ss2d.Group},dispose:function(){this.group.dispose();for(var t=0;this.m_displayerlist.length>t;t++)this.removeChild(this.m_displayerlist[t]),this.m_displayerlist[t]=null;this.m_displayerlist=null},addChild:function(t){t instanceof ss2d.Sprite?(this.m_displayerlist.push(t),t.group.setParentGroup(this.group),t.setParent(this)):t instanceof ss2d.MovieClip&&(this.m_displayerlist.push(t),this.group.addChild(t.m_quad))},removeChild:function(t){this.m_displayerlist.splice(this.m_displayerlist.indexOf(t),1),t.group.clearParentGroup(),t.setParent(null)},paint:function(){for(var t=0;this.m_displayerlist.length>t;t++){var e=this.m_displayerlist[t];e.dispatchEvent(ss2d.Event.ENTER_FRAME),e.paint()}},getQuadsUnderPoint:function(t,e){for(var s=null,i=this.m_displayerlist.length-1;i>=0;i--)if(s=this.m_displayerlist[i].getQuadsUnderPoint(t,e),null!=s)return s;return s},getX:function(){return this.group._x},setX:function(t){this.group._x=t,this.group.isRedraw=!0},getY:function(){return this.group._y},setY:function(t){this.group._y=t,this.group.isRedraw=!0},getWidth:function(){return this.group.m_width},setWidth:function(t){this.group.m_width=t,this.group.isRedraw=!0},getHeight:function(){return this.group.m_height},setHeight:function(t){this.group.m_height=t,this.group.isRedraw=!0},getScaleX:function(){return this.group.m_scaleX},setScaleX:function(t){this.group.m_scaleX=t,this.group.isRedraw=!0},getScaleY:function(){return this.group.m_scaleY},setScaleY:function(t){this.group.m_scaleY=t,this.group.isRedraw=!0},getSkewX:function(){return this.group.m_skewX},setSkewX:function(t){this.group.m_skewX=t,this.group.isRedraw=!0},getSkewY:function(){return this.group.m_skewY},setSkewY:function(t){this.group.m_skewY=t,this.group.isRedraw=!0},getRotation:function(){return this.group.m_rotation},setRotation:function(t){this.group.m_rotation=t,this.group.isRedraw=!0},getVisible:function(){return this.m_visible},setVisible:function(t){this.m_visible=t},getParent:function(){return this.m_parent},setParent:function(t){this.m_parent=t},getMouseEnabled:function(){return this.m_mouseEnabled},setMouseEnabled:function(t){this.m_mouseEnabled=t},getUserData:function(){return this.m_userData},setUserData:function(t){this.m_userData=t}})}(),function(){ss2d.MovieClip=Class({Extends:ss2d.Scene,x:0,y:0,m_r:1,m_g:1,m_b:1,m_a:1,m_width:1,m_height:1,m_parent:null,m_mouseEnabled:!1,m_userData:null,m_center:!1,m_forceCenter:!1,m_quad:null,initialize:function(t){this.init(t)},init:function(t){this.displayerlist=[],this.glScissorX=0,this.glScissorY=0,this.glScissorWidth=ss2d.Stage2D.canvas.width,this.glScissorHeight=ss2d.Stage2D.canvas.height,this.quadList=[],this.maxQuadNum=1,this.m_indexList=new Uint16Array(6*this.maxQuadNum),this.m_jointList=new Float32Array(8*this.maxQuadNum),this.m_verticesGPUList=new Float32Array(8*this.maxQuadNum),this.m_verticesList=new Float32Array(8*this.maxQuadNum),this.m_uvList=new Float32Array(8*this.maxQuadNum),this.m_colorList=new Float32Array(16*this.maxQuadNum),this.m_texture=t,t instanceof Array?(this.m_isJoint=!0,this.shader=new ss2d.ShaderJoint):this.shader=ss2d.Stage2D.shader,this.m_sfactor=ss2d.Stage2D.gl.ONE,this.m_dfactor=ss2d.Stage2D.gl.ONE_MINUS_SRC_ALPHA;for(var e=0;this.maxQuadNum>e;e++)this.quadList.push(new ss2d.Quad(e,this.m_texture,this.m_verticesList,this.m_uvList,this.m_colorList,this.m_jointList,this.m_indexList,this.m_verticesGPUList));this.m_quad=this.applyQuad(!0),this.showQuad(this.m_quad),this.verticesGPUBuffer=ss2d.Stage2D.gl.createBuffer(),this.verticesJointBuffer=ss2d.Stage2D.gl.createBuffer(),this.verticesColorBuffer=ss2d.Stage2D.gl.createBuffer(),this.vertexPositionBuffer=ss2d.Stage2D.gl.createBuffer(),this.vertexTextureUvdBuffer=ss2d.Stage2D.gl.createBuffer(),this.vertexIndexBuffer=ss2d.Stage2D.gl.createBuffer()},hitTestPoint:function(t,e){var s=this.absCentre(),i=Math.abs(s.x-t),r=Math.abs(s.y-e);return this.getWidth()/2>=i&&this.getHeight()/2>=r?!0:!1},hitTestObject:function(t){var e=this.absCentre(),s=t.absCentre(),i=Math.abs(e.x-s.x),r=Math.abs(e.y-s.y);return this.getWidth()/2+this.getWidth()/2>=i&&t.getHeight()/2+t.getHeight()/2>=r?!0:!1},hitTestRoundness:function(t,e,s){var i=this.absCentre(),r=Math.abs(i.x-t),a=Math.abs(i.y-e),n=Math.sqrt(r*r+a*a);return s>=n?!0:!1},setTextureID:function(t){this.m_quad.setTextureID(t)},getTextureID:function(){return this.m_quad.getTextureID()},setTileName:function(t){this.m_quad.setTileName(t)},setTileId:function(t){this.m_quad.setTileId(t)},setAnimationSpeed:function(t){this.m_quad.setAnimationSpeed(t)},queryName:function(t){this.m_quad.queryName(t)},loop:function(t){this.m_quad.loop(t)},play:function(){this.m_quad.play()},stop:function(){this.m_quad.stop()},rollbackAnimation:function(t){this.m_quad.rollbackAnimation(t)},gotoAndPlay:function(t){this.m_quad.gotoAndPlay(t)},gotoAndStop:function(t){this.m_quad.gotoAndStop(t)},addFrameScript:function(t){this.m_quad.addFrameScript(t)},removeFrameScript:function(t){this.m_quad.removeFrameScript(t)},removeAllFrameScript:function(){this.m_quad.removeAllFrameScript()},frameDelay:function(t){this.m_quad.frameDelay(t)},getCenter:function(){return this.m_quad.getCenter()},setCenter:function(t){this.m_quad.setCenter(t)},getCurrentFrame:function(){return this.m_quad.getCurrentFrame()},getTotalFrame:function(){return this.m_quad.getTotalFrame()},setTileXOffset:function(t){this.m_quad.setTileXOffset(t)},getTileXOffset:function(){return this.m_quad.getTileXOffset()},setTileYOffset:function(t){this.m_quad.setTileYOffset(t)},getTileYOffset:function(){return this.m_quad.setTileYOffset()},setTileWidthOffset:function(t){this.m_quad.setTileWidthOffset(t)},getTileWidthOffset:function(){return this.m_quad.setTileWidthOffset()},setTileHeightOffset:function(t){this.m_quad.setTileHeightOffset(t)},getTileHeightOffset:function(){return this.m_quad.setTileHeightOffset()},dispose:function(){this.m_quad.dispose()},absCentre:function(){return this.m_quad.absCentre()},setTransform:function(t){this.m_quad.setTransform(t)},getTransform:function(){return this.m_quad.getTransform()},paint:function(){ss2d.Stage2D.gl.blendFunc(this.m_sfactor,this.m_dfactor);for(var t=this.quadList.length,e=0;t>e;e++){var s=this.quadList[e];if(null!=s.scene&&s.m_visible&&s.m_isActivate)if(s.m_isPlaying&&(s.m_targetTime=(new Date).getTime(),s.m_targetTime-s.m_lastTime>=s.m_delay&&(s.m_lastTime=s.m_targetTime,s.updateFrame(!0))),s.isRedraw&&(s.isRedraw=!1,s.m_quadMatrixUtil.setX(2*s.x/ss2d.Stage2D.stageHeight),s.m_quadMatrixUtil.setY(2*s.y/ss2d.Stage2D.stageHeight),s.m_quadMatrixUtil.setRotation(s.m_rotation),s.m_quadMatrixUtil.upDateMatrixData(2*(-s.m_pivotX+s.m_framePivotX)*s.m_scaleX/ss2d.Stage2D.stageHeight,2*(-s.m_pivotY+s.m_framePivotY)*s.m_scaleY/ss2d.Stage2D.stageHeight,s.m_scaleX*(s.m_frameWidth/s.m_Texture.width),s.m_scaleY*(s.m_frameHeight/s.m_Texture.height),s.m_skewX,s.m_skewY),s.m_quadMatrixUtil.upDateMatrix(null==s.m_transform),null!=s.m_transform&&(s.m_quadMatrixUtil.getMatrix2D().rawData=s.m_quadMatrixUtil.getMatrix2D().add3x3(s.m_quadMatrixUtil.getMatrix2D().rawData,s.m_transform.rawData),s.m_quadMatrixUtil.upDateRaw()),s.frameXDivWidth=s.m_frameX/s.m_Texture.width,s.frameYDivHeight=s.m_frameY/s.m_Texture.height,s.frameWidthDivWidth=s.m_frameWidth/s.m_Texture.width,s.frameHeightDivHeight=s.m_frameHeight/s.m_Texture.height,s.textureUV[s.id8_1]=s.frameXDivWidth,s.textureUV[s.id8_2]=-s.frameYDivHeight,s.textureUV[s.id8_3]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_4]=-s.frameYDivHeight,s.textureUV[s.id8_5]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_6]=-s.frameHeightDivHeight-s.frameYDivHeight,s.textureUV[s.id8_7]=s.frameXDivWidth,s.textureUV[s.id8_8]=-s.frameHeightDivHeight-s.frameYDivHeight),s.isAnimationMatrix||(s.frameXDivWidth=s.m_frameX/s.m_Texture.width,s.frameYDivHeight=s.m_frameY/s.m_Texture.height,s.frameWidthDivWidth=s.m_frameWidth/s.m_Texture.width,s.frameHeightDivHeight=s.m_frameHeight/s.m_Texture.height,s.textureUV[s.id8_1]=s.frameXDivWidth,s.textureUV[s.id8_2]=-s.frameYDivHeight,s.textureUV[s.id8_3]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_4]=-s.frameYDivHeight,s.textureUV[s.id8_5]=s.frameWidthDivWidth+s.frameXDivWidth,s.textureUV[s.id8_6]=-s.frameHeightDivHeight-s.frameYDivHeight,s.textureUV[s.id8_7]=s.frameXDivWidth,s.textureUV[s.id8_8]=-s.frameHeightDivHeight-s.frameYDivHeight),s.GPU&&(s.verticesGPUList[s.id8_1]=2*s.GPUX/ss2d.Stage2D.stageHeight,s.verticesGPUList[s.id8_2]=2*s.GPUY/ss2d.Stage2D.stageHeight,s.verticesGPUList[s.id8_3]=s.verticesGPUList[s.id8_1],s.verticesGPUList[s.id8_4]=s.verticesGPUList[s.id8_2],s.verticesGPUList[s.id8_5]=s.verticesGPUList[s.id8_1],s.verticesGPUList[s.id8_6]=s.verticesGPUList[s.id8_2],s.verticesGPUList[s.id8_7]=s.verticesGPUList[s.id8_1],s.verticesGPUList[s.id8_8]=s.verticesGPUList[s.id8_2]),s.vertices[s.id8_1]=s.leftUpPoint.x,s.vertices[s.id8_2]=s.leftUpPoint.y,s.vertices[s.id8_3]=s.rightUpPoint.x,s.vertices[s.id8_4]=s.rightUpPoint.y,s.vertices[s.id8_5]=s.rightDownPoint.x,s.vertices[s.id8_6]=s.rightDownPoint.y,s.vertices[s.id8_7]=s.leftDownPoint.x,s.vertices[s.id8_8]=s.leftDownPoint.y,s.jointList[s.id8_1]=s.m_textureID,s.jointList[s.id8_2]=s.m_textureID,s.jointList[s.id8_3]=s.m_textureID,s.jointList[s.id8_4]=s.m_textureID,s.jointList[s.id8_5]=s.m_textureID,s.jointList[s.id8_6]=s.m_textureID,s.jointList[s.id8_7]=s.m_textureID,s.jointList[s.id8_8]=s.m_textureID,s.isVertexColour){var i=s.m_r*s.m_alpha,r=s.m_g*s.m_alpha,a=s.m_b*s.m_alpha,n=s.m_a*s.m_alpha;s.verticesColor[s.id16_1]=i*s.m_leftUpR,s.verticesColor[s.id16_2]=r*s.m_leftUpG,s.verticesColor[s.id16_3]=a*s.m_leftUpB,s.verticesColor[s.id16_4]=n*s.m_leftUpA,s.verticesColor[s.id16_5]=i*s.m_rightUpR,s.verticesColor[s.id16_6]=r*s.m_rightUpG,s.verticesColor[s.id16_7]=a*s.m_rightUpB,s.verticesColor[s.id16_8]=n*s.m_rightUpA,s.verticesColor[s.id16_9]=i*s.m_rightDownR,s.verticesColor[s.id16_10]=r*s.m_rightDownG,s.verticesColor[s.id16_11]=a*s.m_rightDownB,s.verticesColor[s.id16_12]=n*s.m_rightDownA,s.verticesColor[s.id16_13]=i*s.m_leftDownR,s.verticesColor[s.id16_14]=r*s.m_leftDownG,s.verticesColor[s.id16_15]=a*s.m_leftDownB,s.verticesColor[s.id16_16]=n*s.m_leftDownA}else s.verticesColor[s.id16_1]=1,s.verticesColor[s.id16_2]=1,s.verticesColor[s.id16_3]=1,s.verticesColor[s.id16_4]=1,s.verticesColor[s.id16_5]=1,s.verticesColor[s.id16_6]=1,s.verticesColor[s.id16_7]=1,s.verticesColor[s.id16_8]=1,s.verticesColor[s.id16_9]=1,s.verticesColor[s.id16_10]=1,s.verticesColor[s.id16_11]=1,s.verticesColor[s.id16_12]=1,s.verticesColor[s.id16_13]=1,s.verticesColor[s.id16_14]=1,s.verticesColor[s.id16_15]=1,s.verticesColor[s.id16_16]=1;else s.vertices[s.id8_1]=0,s.vertices[s.id8_2]=0,s.vertices[s.id8_3]=0,s.vertices[s.id8_4]=0,s.vertices[s.id8_5]=0,s.vertices[s.id8_6]=0,s.vertices[s.id8_7]=0,s.vertices[s.id8_8]=0;s.dispatchEvent(ss2d.Event.ENTER_FRAME)}this.shader.upDataShader(this),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),ss2d.Stage2D.gl.drawElements(ss2d.Stage2D.gl.TRIANGLES,6*this.maxQuadNum,ss2d.Stage2D.gl.UNSIGNED_SHORT,0)},getColor:function(){this.m_quad.getColor()},setColor:function(t){this.m_quad.setColor(t)},setVertexColour:function(t,e,s,i,r){this.m_quad.setVertexColour(t,e,s,i,r)},getR:function(){return this.m_quad.getR()},setR:function(t){this.m_quad.setR(t)},getG:function(){return this.m_quad.getG()},setG:function(t){this.m_quad.setG(t)},getB:function(){return this.m_quad.getB()},setB:function(t){this.m_quad.setB(t)},getA:function(){return this.m_quad.getA()},setA:function(t){this.m_quad.setA(t)},getX:function(){return this.m_quad.getX()},setX:function(t){this.m_quad.setX(t)},getY:function(){return this.m_quad.getY()},setY:function(t){this.m_quad.setY(t)},getWidth:function(){return this.m_quad.getWidth()},setWidth:function(t){this.m_quad.setWidth(t)},getHeight:function(){return this.m_quad.getHeight()},setHeight:function(t){this.m_quad.setHeight(t)},getScaleX:function(){return this.m_quad.getScaleX()},setScaleX:function(t){this.m_quad.setScaleX(t)},getScaleY:function(){return this.m_quad.getScaleY()},setScaleY:function(t){this.m_quad.setScaleY(t)},getSkewX:function(){return this.m_quad.getSkewX()},setSkewX:function(t){this.m_quad.setSkewX(t)},getSkewY:function(){return this.m_quad.getSkewY()},setSkewY:function(t){this.m_quad.setSkewY(t)},getRotation:function(){return this.m_quad.getRotation()},setRotation:function(t){this.m_quad.setRotation(t)},getAlpha:function(){return this.m_quad.getAlpha()},setAlpha:function(t){this.m_quad.setAlpha(t)},getVisible:function(){return this.m_quad.getVisible()},setVisible:function(t){this.m_quad.setVisible(t)},getIsRedraw:function(){return this.m_quad.getIsRedraw()},setIsRedraw:function(t){this.m_quad.setIsRedraw(t)
},getParent:function(){return this.m_parent},setParent:function(t){this.m_parent=t},getMouseEnabled:function(){return this.m_quad.getMouseEnabled()},setMouseEnabled:function(t){this.m_quad.setMouseEnabled(t)},getUserData:function(){return this.m_userData},setUserData:function(t){this.m_userData=t},getForceCenter:function(){return this.m_quad.getForceCenter()},setForceCenter:function(t){this.m_quad.setForceCenter(t)}})}(),function(){ss2d.TextField=Class({Extends:ss2d.MovieClip,m_textCanvas:null,m_textStyle:null,m_texture:null,m_text:null,m_size:30,m_typeface:"黑体",m_textColor:"rgb(200,0,0)",m_alpha:null,m_font:"",m_width:null,m_height:null,initialize:function(t,e){this.m_alpha=1,this.m_textCanvas=document.createElement("canvas"),t?(this.m_textCanvas.width=t,this.m_width=t):(this.m_textCanvas.width=256,this.m_width=256),e?(this.m_textCanvas.height=e,this.m_height=e):(this.m_textCanvas.height=256,this.m_height=256),this.m_textStyle=this.m_textCanvas.getContext("2d"),this.m_textStyle.textBaseline="middle",this.m_textStyle.font=this.m_size+"px "+this.m_typeface,this.m_texture=new ss2d.Texture(this.m_textCanvas),this.init(this.m_texture)},setFontSize:function(t){this.m_size=t,this.m_font=this.m_size+"px "+this.m_typeface},getFontSize:function(){return this.m_size},setText:function(t,e,s){this.m_textStyle.clearRect(0,0,this.m_width,this.m_height),this.m_textStyle.font=this.m_font,this.m_textStyle.globalAlpha=this.m_alpha,this.m_textStyle.fillStyle=this.m_textColor,this.m_text=t,e?this.m_textStyle.fillText(t,e,0+this.m_size/2):e&&s?this.m_textStyle.fillText(t,e,s+this.m_size/2):this.m_textStyle.fillText(t,0,0+this.m_size/2),this.m_texture.dispose(),this.m_texture.newCanvas(this.m_textCanvas,10497,10497,9729,9729)},getText:function(){return this.m_text},setTypefac:function(t){this.m_typeface=t,this.m_font=this.m_size+"px "+this.m_typeface},getTypefac:function(){return this.m_typeface},setColor:function(t,e,s){this.m_textColor="rgb("+parseInt(255*t)+","+parseInt(255*e)+","+parseInt(255*s)+")"},setAlpha:function(t){this.m_alpha=t},getAlpha:function(){return this.m_alpha}})}(),function(){ss2d.QuadFrame=Class({name:"",x:0,y:0,width:0,height:0,frameX:0,frameY:0,frameWidth:0,frameHeight:0}),ss2d.QuadData=Class({name:null,quadFrameLst:null,initialize:function(){quadFrameLst=[]}}),ss2d.QuadResource=Class({quadDataList:null,initialize:function(){quadDataList=[]}}),ss2d.Quad=Class({Extends:ss2d.DisplayObject,isAnimationMatrix:!0,isVertexColour:!0,m_Texture:null,m_isJoint:!1,m_frameX:0,m_frameY:0,m_frameWidth:0,m_frameHeight:0,m_tileOffsetX:0,m_tileOffsetY:0,m_tileOffsetWidth:0,m_tileOffsetHeight:0,m_framePivotX:0,m_framePivotY:0,m_isActivate:!1,m_loop:!1,m_quadMatrixUtil:null,m_leftUpR:1,m_leftUpG:1,m_leftUpB:1,m_leftUpA:1,m_leftDownR:1,m_leftDownG:1,m_leftDownB:1,m_leftDownA:1,m_rightUpR:1,m_rightUpG:1,m_rightUpB:1,m_rightUpA:1,m_rightDownR:1,m_rightDownG:1,m_rightDownB:1,m_rightDownA:1,scene:null,m_id:-1,id8_1:0,id8_2:0,id8_3:0,id8_4:0,id8_5:0,id8_6:0,id8_7:0,id8_8:0,id16_1:0,id16_2:0,id16_3:0,id16_4:0,id16_5:0,id16_6:0,id16_7:0,id16_8:0,id16_9:0,id16_10:0,id16_11:0,id16_12:0,id16_13:0,id16_14:0,id16_15:0,id16_16:0,m_textureID:0,texture:null,textureUV:null,verticesGPUList:null,vertices:null,verticesColor:null,m_isPlaying:!1,m_transform:null,m_lastTime:0,m_targetTime:0,m_delay:0,m_tileId:0,_tileName:null,m_currentFrame:0,m_totalFrame:1,frameList:null,jointList:null,indexList:null,rightDownPoint:null,rightUpPoint:null,leftDownPoint:null,leftUpPoint:null,m_framedelay:-1,m_isRollbackAnimation:!1,frameXDivWidth:0,frameYDivHeight:0,frameWidthDivWidth:0,frameHeightDivHeight:0,initialize:function(t,e,s,i,r,a,n,o){ss2d.Quad.Super.call(this),this._absPoint=new ss2d.Point,this.jointList=[],this.frameList=[],this.indexList=[],this.m_isJoint=!1,this.m_isActivate=!1,e instanceof Array&&(this.m_isJoint=!0),this.setID(t),this.texture=e,this.vertices=s,this.verticesGPUList=o,this.textureUV=i,this.verticesColor=r,this.jointList=a,this.indexList=n,this.rightDownPoint=new ss2d.Point(0,0),this.rightUpPoint=new ss2d.Point(0,0),this.leftDownPoint=new ss2d.Point(0,0),this.leftUpPoint=new ss2d.Point(0,0),this.m_quadMatrixUtil=new ss2d.QuadMatrixUtil,this.setTextureID(0),this.m_isJoint?(this.m_frameWidth=e[this.m_textureID].width+this.m_tileOffsetWidth,this.m_frameHeight=e[this.m_textureID].height+this.m_tileOffsetHeight):(this.m_frameWidth=e.width,this.m_frameHeight=e.height),this.initIndexs(),this.initVerticeData(),this.setTileId(0),this.gotoAndPlay(1)},setVertexColour:function(t,e,s,i,r){switch(t){case 0:this.m_leftUpR=e,this.m_leftUpG=s,this.m_leftUpB=i,this.m_leftUpA=r;break;case 1:this.m_leftDownR=e,this.m_leftDownG=s,this.m_leftDownB=i,this.m_leftDownA=r;break;case 2:this.m_rightUpR=e,this.m_rightUpG=s,this.m_rightUpB=i,this.m_rightUpA=r;break;case 3:this.m_rightDownR=e,this.m_rightDownG=s,this.m_rightDownB=i,this.m_rightDownA=r}this.isRedraw=!0},getWidth:function(){var t=this.m_frameWidth;return Math.abs(t*this.m_scaleX)},setWidth:function(t){var e=this.m_frameWidth;this.m_scaleX=t/e,this.isRedraw=!0},getHeight:function(){var t=this.m_frameHeight;return Math.abs(t*this.m_scaleY)},setHeight:function(t){var e=this.m_frameHeight;this.m_scaleY=t/e,this.isRedraw=!0},getCenter:function(){return this.m_center},setCenter:function(t){this.m_center=t,this.updateFrame()},initIndexs:function(){var t=5*this.m_id,e=4*this.m_id;this.indexList[this.m_id+t+0]=0+e,this.indexList[this.m_id+t+1]=1+e,this.indexList[this.m_id+t+2]=2+e,this.indexList[this.m_id+t+3]=0+e,this.indexList[this.m_id+t+4]=2+e,this.indexList[this.m_id+t+5]=3+e},initVerticeData:function(){for(var t=8*this.m_id,e=0;8>e;e++)this.verticesGPUList[t+e]=0,this.vertices[t+e]=0,this.textureUV[t+e]=0;for(var s=16*this.m_id,i=0;16>i;i++)this.verticesColor[s+i]=0},setTextureID:function(t){this.m_textureID=t,this.m_Texture=this.m_isJoint?this.texture[this.m_textureID]:this.texture,this.leftUpPoint.x=-1*this.m_Texture.width/ss2d.Stage2D.stageHeight,this.leftUpPoint.y=-1*this.m_Texture.height/ss2d.Stage2D.stageHeight,this.rightUpPoint.x=1*this.m_Texture.width/ss2d.Stage2D.stageHeight,this.rightUpPoint.y=-1*this.m_Texture.height/ss2d.Stage2D.stageHeight,this.leftDownPoint.x=-1*this.m_Texture.width/ss2d.Stage2D.stageHeight,this.leftDownPoint.y=1*this.m_Texture.height/ss2d.Stage2D.stageHeight,this.rightDownPoint.x=1*this.m_Texture.width/ss2d.Stage2D.stageHeight,this.rightDownPoint.y=1*this.m_Texture.height/ss2d.Stage2D.stageHeight,this.m_quadMatrixUtil.clear(),this.m_quadMatrixUtil.addItem(this.leftUpPoint),this.m_quadMatrixUtil.addItem(this.leftDownPoint),this.m_quadMatrixUtil.addItem(this.rightUpPoint),this.m_quadMatrixUtil.addItem(this.rightDownPoint),this.setTileId(0)},getTextureID:function(){return this.m_textureID},setTileName:function(t){this._tileName=t,null!=this.m_Texture.quadResource&&this.setTileId(this.queryName(this._tileName))},setTileId:function(t){null!=this.m_Texture.quadResource&&(this.m_tileId=t,this.m_currentFrame=0,this.m_totalFrame=this.m_Texture.quadResource.quadDataList[this.m_tileId].quadFrameLst.length,this.updateFrame(!1))},getCurrentFrame:function(){return this.m_currentFrame},getTotalFrame:function(){return this.m_totalFrame},setTileXOffset:function(t){this.m_tileOffsetX=t,this.isRedraw=!0},getTileXOffset:function(){return this.m_tileOffsetX},setTileYOffset:function(t){this.m_tileOffsetY=t,this.isRedraw=!0},getTileYOffset:function(){return this.m_tileOffsetY},setTileWidthOffset:function(t){this.m_tileOffsetWidth=t,this.isRedraw=!0},getTileWidthOffset:function(){return this.m_tileOffsetWidth},setTileHeightOffset:function(t){this.m_tileOffsetHeight=t,this.isRedraw=!0},getTileHeightOffset:function(){return this.m_tileOffsetHeight},setAnimationSpeed:function(t){this.m_delay=1e3/t},launch:function(){this.m_isActivate=!0,this.m_visible=!0,this.x=0,this.y=0,this.GPUX=0,this.GPUY=0,this.setTileId(0)},getIsActivate:function(){return this.m_isActivate},setIndexVertex:function(t,e,s){this.isRedraw=!0,this.m_quadMatrixUtil.getPoint(t).x=e*this.m_Texture.width/ss2d.Stage2D.stageHeight,this.m_quadMatrixUtil.getPoint(t).y=s*this.m_Texture.height/ss2d.Stage2D.stageHeight},getIndexVertex:function(t){return new ss2d.Point(this.m_quadMatrixUtil.getPoint(t).x/this.m_Texture.width*ss2d.Stage2D.stageHeight,this.m_quadMatrixUtil.getPoint(t).y/this.m_Texture.width*ss2d.Stage2D.stageHeight)},getVertex:function(t){switch(t){case 0:return this.leftUpPoint;case 1:return this.leftDownPoint;case 2:return this.rightUpPoint;case 3:return this.rightDownPoint}},queryName:function(t){var e;e=this.m_isJoint?this.texture[this.m_textureID].quadResource.quadDataList:this.texture.quadResource.quadDataList;for(var s=0;e.length>s;s++)if(e[s].name==t)return s;return 0},loop:function(t){this.m_loop=t},play:function(){this.m_isPlaying=!0},stop:function(){this.m_isPlaying=!1},gotoAndPlay:function(t){this.m_currentFrame=t-1,this.m_isPlaying=!0},gotoAndStop:function(t){this.m_isPlaying=!1,this.m_currentFrame=t-1,this.updateFrame(!1)},addFrameScript:function(t){this.frameList.push(t)},removeFrameScript:function(t){var e=this.frameList.indexOf(t);this.frameList.splice(e,1)},removeAllFrameScript:function(){for(var t=0;this.frameList.length>t;t++)this.frameList.splice(t,1),this.frameList[t]=null;this.frameList=[]},rollbackAnimation:function(t){this.m_isRollbackAnimation=t},frameDelay:function(t){this.m_framedelay=t},updateFrame:function(t){if(null!=this.m_Texture.quadResource){if(t)if(this.m_framedelay>0)this.m_framedelay--;else if(this.m_isRollbackAnimation){this.m_currentFrame--;for(var e=0;this.frameList.length>e;e++)if(this.frameList[e].frame==this.m_currentFrame+1){var s=this.frameList[e].callback;s.handleEvent?s.handleEvent(this):s(this)}}else{for(var e=0;this.frameList.length>e;e++)if(this.frameList[e].frame==this.m_currentFrame+1){var s=this.frameList[e].callback;s.handleEvent?s.handleEvent(this):s(this)}this.m_currentFrame++}this.m_currentFrame>=this.m_totalFrame?this.m_currentFrame=this.m_loop?0:this.m_totalFrame-1:-1>=this.m_currentFrame&&(this.m_currentFrame=this.m_loop?this.m_totalFrame-1:0),this.updateFrameData()}else this.m_frameX=this.m_tileOffsetX,this.m_frameY=this.m_tileOffsetY,this.m_isJoint?(this.m_frameWidth=this.m_Texture[this.m_textureID].width+this.m_tileOffsetWidth,this.m_frameHeight=this.m_Texture[this.m_textureID].height+this.m_tileOffsetHeight):(this.m_frameWidth=this.m_Texture.width+this.m_tileOffsetWidth,this.m_frameHeight=this.m_Texture.height+this.m_tileOffsetHeight),this.m_center?(this.m_framePivotX=0,this.m_framePivotY=0):(this.m_framePivotY=this.m_frameHeight/2,this.m_framePivotX=this.m_frameWidth/2)},upAbsPoint:function(){var t=Math.min.apply(Math,[this.leftUpPoint.x,this.rightUpPoint.x,this.leftDownPoint.x,this.rightDownPoint.x]),e=Math.min.apply(Math,[this.leftUpPoint.y,this.rightUpPoint.y,this.leftDownPoint.y,this.rightDownPoint.y]),s=Math.max.apply(Math,[this.leftUpPoint.x,this.rightUpPoint.x,this.leftDownPoint.x,this.rightDownPoint.x]),i=Math.max.apply(Math,[this.leftUpPoint.y,this.rightUpPoint.y,this.leftDownPoint.y,this.rightDownPoint.y]),r=(t+(s-t)/2)*ss2d.Stage2D.stageHeight/2,a=(e+(i-e)/2)*ss2d.Stage2D.stageHeight/2;this._absPoint.x=r+this.GPUX,this._absPoint.y=a+this.GPUY},absCentre:function(){return this.upAbsPoint(),this._absPoint},setTransform:function(t){this.m_transform=t},getTransform:function(){return this.m_transform},updateFrameData:function(){if(null!=this.m_Texture.quadResource){var t=this.m_Texture.quadResource.quadDataList[this.m_tileId].quadFrameLst[this.m_currentFrame];if(!t)return;this.m_frameX=Number(t.x)+this.m_tileOffsetX,this.m_frameY=Number(t.y)+this.m_tileOffsetY,this.m_frameWidth=Number(t.width)+this.m_tileOffsetWidth,this.m_frameHeight=Number(t.height)+this.m_tileOffsetHeight,this.m_forceCenter?(this.m_framePivotX=-Number(t.frameX),this.m_framePivotY=-Number(t.frameY)):this.m_center?(this.m_framePivotX=this.m_frameWidth/2-Number(t.frameX)-Number(t.frameWidth)/2,this.m_framePivotY=this.m_frameHeight/2-Number(t.frameY)-Number(t.frameHeight)/2):(this.m_framePivotX=this.m_frameWidth/2-Number(t.frameX),this.m_framePivotY=this.m_frameHeight/2-Number(t.frameY))}this.isAnimationMatrix&&(this.isRedraw=!0)},dispose:function(){this.m_isPlaying=!0,this.m_lastTime=0,this.m_targetTime=0,this.m_delay=0,this.m_tileId=0,this.m_userData=null,this.m_transform=null,this.m_currentFrame=0,this.m_totalFrame=1,this.m_visible=!1,this.m_isActivate=!1,this.m_parent=null,this.m_rotation=0,this.m_frameX=0,this.m_frameY=0,this.m_scaleX=1,this.m_scaleY=1,this.m_skewX=0,this.m_skewY=0,this.m_pivotX=0,this.m_pivotY=0,this.GPU=!1,this.GPUX=Number.MAX_VALUE,this.GPUY=Number.MAX_VALUE,this.x=Number.MAX_VALUE,this.y=Number.MAX_VALUE,this.m_r=1,this.m_g=1,this.m_b=1,this.m_a=1,this.m_alpha=1,this.m_tileOffsetX=0,this.m_tileOffsetY=0,this.m_tileOffsetWidth=0,this.m_tileOffsetHeight=0,this.m_center=!1,this.m_forceCenter=!1,this.m_framePivotY=this.m_frameHeight/2,this.m_framePivotX=this.m_frameWidth/2,this.removeAllFrameScript()},getScene:function(){return this.scene},setScene:function(t){this.scene=t},setID:function(t){this.m_id=t;var e=8*this.m_id;this.id8_1=e,this.id8_2=e+1,this.id8_3=e+2,this.id8_4=e+3,this.id8_5=e+4,this.id8_6=e+5,this.id8_7=e+6,this.id8_8=e+7;var s=16*this.m_id;this.id16_1=s,this.id16_2=s+1,this.id16_3=s+2,this.id16_4=s+3,this.id16_5=s+4,this.id16_6=s+5,this.id16_7=s+6,this.id16_8=s+7,this.id16_9=s+8,this.id16_10=s+9,this.id16_11=s+10,this.id16_12=s+11,this.id16_13=s+12,this.id16_14=s+13,this.id16_15=s+14,this.id16_16=s+15},paint:function(){}})}(),function(){ss2d.Stage2D=Class({Extends:ss2d.EventDispatcher,STATIC:{instance:null,stageWidth:640,stageHeight:480,mouseX:0,mouseY:0,r:0,g:0,b:0,a:1,ratio:1,shader:null,ovMatrix:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],canvas:null,context:null,textCanvas:null,textContext:null,gl:null,rttFramebuffer:null,rttTexture:null,fps:0,fpsTime:0,getTextCanvas:function(){return null==ss2d.Stage2D.textCanvas&&(ss2d.Stage2D.textCanvas=document.createElement("canvas")),ss2d.Stage2D.textCanvas},getTextContext:function(){return null==ss2d.Stage2D.textContext&&(ss2d.Stage2D.textContext=ss2d.Stage2D.getTextCanvas().getContext("2d")),ss2d.Stage2D.textContext}},displayerlist:null,frameBufflist:null,initialize:function(t,e,s){return this.displayerlist=[],this.frameBufflist=[],ss2d.stage=this,ss2d.Stage2D.instance=this,ss2d.Stage2D.canvas=document.getElementById(t),void 0==ss2d.Stage2D.canvas&&(ss2d.Stage2D.canvas=ss2d.canvas),e=e||"auto",s=s||"auto",this.size(e,s),ss2d.Stage2D.gl=ss2d.WebGLUtil.setupWebGL(ss2d.Stage2D.canvas),null==ss2d.Stage2D.gl?(alert("当前浏览器不支持webgl！"),void 0):(ss2d.Stage2D.gl.viewport(0,0,ss2d.Stage2D.canvas.width,ss2d.Stage2D.canvas.height),ss2d.Stage2D.gl.enable(ss2d.Stage2D.gl.BLEND),ss2d.Stage2D.gl.enable(ss2d.Stage2D.gl.SCISSOR_TEST),ss2d.Stage2D.gl.disable(ss2d.Stage2D.gl.DEPTH_TEST),ss2d.Stage2D.shader=new ss2d.ShaderGLSL,ss2d[this.onMouseEventHandler]=this.onMouseEventHandler.bind(this),ss2d[this.onDrawFrame]=this.onDrawFrame.bind(this),ss2d.Stage2D.canvas.addEventListener("mousedown",ss2d[this.onMouseEventHandler],!1),ss2d.Stage2D.canvas.addEventListener("mouseup",ss2d[this.onMouseEventHandler],!1),ss2d.Stage2D.canvas.addEventListener("mousemove",ss2d[this.onMouseEventHandler],!1),ss2d.Stage2D.canvas.addEventListener("touchstart",ss2d[this.onMouseEventHandler],!1),ss2d.Stage2D.canvas.addEventListener("touchend",ss2d[this.onMouseEventHandler],!1),ss2d.Stage2D.canvas.addEventListener("touchmove",ss2d[this.onMouseEventHandler],!1),this.onDrawFrame(),void 0)},addChild:function(t){t.stage=this,this.displayerlist.push(t)},removeChild:function(t){var e=this.displayerlist.indexOf(t);e>-1&&(t.stage=null,this.displayerlist.splice(e,1))},size:function(t,e){"string"==typeof t&&"auto"==t&&(t=window.screen.availWidth),"string"==typeof e&&"auto"==e&&(e=window.screen.availHeight),ss2d.Stage2D.canvas.style.width=t+"px",ss2d.Stage2D.canvas.style.height=e+"px",ss2d.Stage2D.stageWidth=ss2d.Stage2D.canvas.width=t,ss2d.Stage2D.stageHeight=ss2d.Stage2D.canvas.height=e,ss2d.Stage2D.ratio=t/e},addFrameBuffer:function(t){this.frameBufflist.push(t)},onDrawFrame:function(){if(ss2d.Stage2D.fps=parseInt(1e3/((new Date).getTime()-ss2d.Stage2D.fpsTime)),ss2d.Stage2D.fpsTime=(new Date).getTime(),this.dispatchEvent(ss2d.Event.ENTER_FRAME),0!=this.frameBufflist.length){ss2d.Stage2D.gl.clear(ss2d.Stage2D.gl.COLOR_BUFFER_BIT),ss2d.Stage2D.gl.clearColor(ss2d.Stage2D.r,ss2d.Stage2D.g,ss2d.Stage2D.b,ss2d.Stage2D.a);for(var t=0;this.frameBufflist.length>t;t++)ss2d.Stage2D.gl.bindFramebuffer(ss2d.Stage2D.gl.FRAMEBUFFER,this.frameBufflist[t]._frameBuff.getTexture().rttFramebuffer),this.frameBufflist[t]._clear&&(ss2d.Stage2D.gl.clear(ss2d.Stage2D.gl.COLOR_BUFFER_BIT),ss2d.Stage2D.gl.clearColor(ss2d.Stage2D.r,ss2d.Stage2D.g,ss2d.Stage2D.b,ss2d.Stage2D.a)),this.frameBufflist[t].paint(),ss2d.Stage2D.gl.bindFramebuffer(ss2d.Stage2D.gl.FRAMEBUFFER,null)}ss2d.Stage2D.gl.clear(ss2d.Stage2D.gl.COLOR_BUFFER_BIT),ss2d.Stage2D.gl.clearColor(ss2d.Stage2D.r,ss2d.Stage2D.g,ss2d.Stage2D.b,ss2d.Stage2D.a);for(var e=0;this.displayerlist.length>e;e++){var s=this.displayerlist[e];s.dispatchEvent(ss2d.Event.ENTER_FRAME),s.paint()}window.requestAnimFrame(ss2d[this.onDrawFrame])},getSceneForemostQuadUnderPoint:function(t,e,s){var i=null,r=t.getQuadsUnderPoint(e,s);if(r){for(var a={index:r.length-1,id:0},n=0;r.length>n;n++)r[n].id>a.id&&(a.id=r[n].id,a.index=n);i=r[a.index]}return i},onMouseEventHandler:function(t){var e=null,s=null;switch(ss2d.log("点击",s),t.type){case"mousedown":case"touchstart":e=ss2d.MouseEvent.MOUSE_DOWN;break;case"mouseup":case"touchend":e=ss2d.MouseEvent.MOUSE_UP;break;case"mousemove":case"touchmove":e=ss2d.MouseEvent.MOUSE_MOVE}var i=ss2d.getElementOffset(ss2d.Stage2D.canvas),r=t.pageX,a=t.pageY;t.touches&&(r=t.touches[0].clientX,a=t.touches[0].clientY),ss2d.Stage2D.mouseX=r-i.left,ss2d.Stage2D.mouseY=a-i.top;for(var n=new ss2d.MouseEvent(e,!1,!1,ss2d.Stage2D.mouseX,ss2d.Stage2D.mouseY),o=this.displayerlist.length-1;o>=0;o--){var h=this.displayerlist[o];if(0!=h.mouseEnabled&&(s=this.getSceneForemostQuadUnderPoint(h,ss2d.Stage2D.mouseX,ss2d.Stage2D.mouseY))){h.dispatchEvent(n,s),s.dispatchEvent(n);break}}this.dispatchEvent(n,s),t.stopPropagation(),t.preventDefault()}})}(),function(){ss2d.TextureStyle=Class({STATIC:{REPEAT:10497,MIRRORED_REPEAT:33648,CLAMP_TO_EDGE:33071,LINEAR:9729,NEAREST:9728},xTile:0,yTile:0,xSampling:0,ySampling:0,initialize:function(){this.xTile=10497,this.yTile=10497,this.xSampling=9729,this.ySampling=9729}})}(),function(){ss2d.Texture=Class({width:0,height:0,texture:null,quadResource:null,regExpTail:null,regExpUnderline:null,regExpIndex:0,cacheframeWidth:0,cacheframeHeight:0,cacheWidth:0,cacheHeight:0,cacheFrameX:0,cacheFrameY:0,rttFramebuffer:null,initialize:function(){1==arguments.length?(this.width=arguments[0].width,this.height=arguments[0].height,arguments[0]instanceof HTMLImageElement?0==ss2d.isPower_2(arguments[0].width)||0==ss2d.isPower_2(arguments[0].height)?(ss2d.canvas.width=ss2d.getScope(arguments[0].width),ss2d.canvas.height=ss2d.getScope(arguments[0].height),ss2d.context.clearRect(0,0,ss2d.canvas.width,ss2d.canvas.height),ss2d.context.drawImage(arguments[0],0,0,arguments[0].width,arguments[0].height,0,0,ss2d.canvas.width,ss2d.canvas.height),this.newCanvas(ss2d.canvas,10497,10497,9729,9729)):this.newBitmap(arguments[0],10497,10497,9729,9729):arguments[0]instanceof HTMLCanvasElement&&this.newCanvas(arguments[0],10497,10497,9729,9729)):2==arguments.length?arguments[0]instanceof HTMLImageElement&&arguments[1]instanceof Document?(this.width=arguments[0].width,this.height=arguments[0].height,this.newSprite(arguments[0],arguments[1],10497,10497,9729,9729)):arguments[0]instanceof HTMLImageElement&&arguments[1]instanceof ss2d.TextureStyle?0==ss2d.isPower_2(arguments[0].width)||0==ss2d.isPower_2(arguments[0].height)?(this.width=arguments[0].width,this.height=arguments[0].height,ss2d.canvas.width=ss2d.getScope(arguments[0].width),ss2d.canvas.height=ss2d.getScope(arguments[0].height),ss2d.context.clearRect(0,0,ss2d.canvas.width,ss2d.canvas.height),ss2d.context.drawImage(arguments[0],0,0,arguments[0].width,arguments[0].height,0,0,ss2d.canvas.width,ss2d.canvas.height),this.newCanvas(ss2d.canvas,arguments[1].xTile,arguments[1].yTile,arguments[1].xSampling,arguments[1].ySampling)):(this.width=arguments[0].width,this.height=arguments[0].height,this.newBitmap(arguments[0],arguments[1].xTile,arguments[1].yTile,arguments[1].xSampling,arguments[1].ySampling)):arguments[0]instanceof HTMLCanvasElement&&arguments[1]instanceof ss2d.TextureStyle?(this.width=arguments[0].width,this.height=arguments[0].height,this.newCanvas(arguments[0],arguments[1].xTile,arguments[1].yTile,arguments[1].xSampling,arguments[1].ySampling)):isNaN(arguments[0])||isNaN(arguments[1])||(this.width=arguments[0],this.height=arguments[1],this.newTexture(arguments[0],arguments[1],10497,10497,9729,9729)):3==arguments.length&&(arguments[0]instanceof HTMLImageElement&&arguments[1]instanceof Document&&arguments[2]instanceof ss2d.TextureStyle?(this.width=arguments[0].width,this.height=arguments[0].height,this.newSprite(arguments[0],arguments[1],arguments[2].xTile,arguments[2].yTile,arguments[2].xSampling,arguments[2].ySampling)):!isNaN(arguments[0])&&!isNaN(arguments[1])&&arguments[2]instanceof ss2d.TextureStyle&&(this.width=arguments[0],this.height=arguments[1],this.newTexture(arguments[0],arguments[1],arguments[2].xTile,arguments[2].yTile,arguments[2].xSampling,arguments[2].ySampling)))},newCanvas:function(t,e,s,i,r){this.texture=ss2d.Stage2D.gl.createTexture(),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,this.texture),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_FLIP_Y_WEBGL,1),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),ss2d.Stage2D.gl.texImage2D(ss2d.Stage2D.gl.TEXTURE_2D,0,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.UNSIGNED_BYTE,t),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MAG_FILTER,i),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MIN_FILTER,r),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_S,e),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_T,s),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,null)},newBitmap:function(t,e,s,i,r){this.texture=ss2d.Stage2D.gl.createTexture(),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,this.texture),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_FLIP_Y_WEBGL,1),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),ss2d.Stage2D.gl.texImage2D(ss2d.Stage2D.gl.TEXTURE_2D,0,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.UNSIGNED_BYTE,t),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MAG_FILTER,i),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MIN_FILTER,r),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_S,e),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_T,s),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,null)},newSprite:function(t,e,s,i,r,a){this.regExpTail=RegExp(/[a-z,0-9,_*]+[0-9]{4}/),this.regExpUnderline=RegExp(/[A-Za-z0-9]*_[A-Za-z0-9]/),this.loadXml(e),this.texture=ss2d.Stage2D.gl.createTexture(),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,this.texture),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_FLIP_Y_WEBGL,1),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),ss2d.Stage2D.gl.texImage2D(ss2d.Stage2D.gl.TEXTURE_2D,0,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.UNSIGNED_BYTE,t),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MAG_FILTER,r),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MIN_FILTER,a),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_S,s),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_T,i),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,null)},newTexture:function(t,e,s,i,r,a){this.texture=ss2d.Stage2D.gl.createTexture(),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,this.texture),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_FLIP_Y_WEBGL,1),ss2d.Stage2D.gl.pixelStorei(ss2d.Stage2D.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),ss2d.Stage2D.gl.texImage2D(ss2d.Stage2D.gl.TEXTURE_2D,0,ss2d.Stage2D.gl.RGBA,t,e,0,ss2d.Stage2D.gl.RGBA,ss2d.Stage2D.gl.UNSIGNED_BYTE,null),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MAG_FILTER,r),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_MIN_FILTER,a),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_S,s),ss2d.Stage2D.gl.texParameteri(ss2d.Stage2D.gl.TEXTURE_2D,ss2d.Stage2D.gl.TEXTURE_WRAP_T,i),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,null)},transformTextureBuffer:function(){this.rttFramebuffer=ss2d.Stage2D.gl.createFramebuffer(),ss2d.Stage2D.gl.bindFramebuffer(ss2d.Stage2D.gl.FRAMEBUFFER,this.rttFramebuffer),ss2d.Stage2D.gl.framebufferTexture2D(ss2d.Stage2D.gl.FRAMEBUFFER,ss2d.Stage2D.gl.COLOR_ATTACHMENT0,ss2d.Stage2D.gl.TEXTURE_2D,this.texture,0),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,null),ss2d.Stage2D.gl.bindFramebuffer(ss2d.Stage2D.gl.FRAMEBUFFER,null)},dispose:function(){ss2d.Stage2D.gl.deleteTexture(this.texture),this.texture=null},loadXml:function(t){this.quadResource=new ss2d.QuadResource;for(var e,s=t.getElementsByTagName("SubTexture"),i=[],r=[],a=0;s.length>a;a++){var n=s[a],o=this.regExpUnderline.test(n.getAttribute("name"));if(ss2d.xmlUnderline)if(o){if(this.regExpIndex=0,e!=n.getAttribute("name").split("_")[0]){e=n.getAttribute("name").split("_")[0],r=[];var h=new ss2d.QuadData;h.name=n.getAttribute("name").split("_")[0],h.quadFrameLst=r,i.push(h),this.cacheframeWidth=0,this.cacheframeHeight=0,this.cacheWidth=0,this.cacheHeight=0,this.cacheFrameX=0,this.cacheFrameY=0}}else{var u=this.regExpTail.test(n.getAttribute("name"));if(u){if(this.regExpIndex=1,e!=n.getAttribute("name").substr(0,n.getAttribute("name").length-4)){e=n.getAttribute("name").substr(0,n.getAttribute("name").length-4),r=[];var h=new ss2d.QuadData;h.name=n.getAttribute("name").substr(0,n.getAttribute("name").length-4),h.quadFrameLst=r,i.push(h),this.cacheframeWidth=0,this.cacheframeHeight=0,this.cacheWidth=0,this.cacheHeight=0,this.cacheFrameX=0,this.cacheFrameY=0}}else if(this.regExpIndex=2,e!=n.getAttribute("name")){e=n.getAttribute("name"),r=[];var h=new ss2d.QuadData;h.name=n.getAttribute("name"),h.quadFrameLst=r,i.push(h),this.cacheframeWidth=0,this.cacheframeHeight=0,this.cacheWidth=0,this.cacheHeight=0,this.cacheFrameX=0,this.cacheFrameY=0}}else{var u=this.regExpTail.test(n.getAttribute("name"));if(u){if(this.regExpIndex=1,e!=n.getAttribute("name").substr(0,n.getAttribute("name").length-4)){e=n.getAttribute("name").substr(0,n.getAttribute("name").length-4),r=[];var h=new ss2d.QuadData;h.name=n.getAttribute("name").substr(0,n.getAttribute("name").length-4),h.quadFrameLst=r,i.push(h),this.cacheframeWidth=0,this.cacheframeHeight=0,this.cacheWidth=0,this.cacheHeight=0,this.cacheFrameX=0,this.cacheFrameY=0}}else if(this.regExpIndex=2,e!=n.getAttribute("name")){e=n.getAttribute("name"),r=[];var h=new ss2d.QuadData;h.name=n.getAttribute("name"),h.quadFrameLst=r,i.push(h),this.cacheframeWidth=0,this.cacheframeHeight=0,this.cacheWidth=0,this.cacheHeight=0,this.cacheFrameX=0,this.cacheFrameY=0}}var l=new ss2d.QuadFrame;l.name=n.getAttribute("name");var d=n.getAttribute("x");null!=d&&(l.x=d),d=n.getAttribute("y"),null!=d&&(l.y=d),d=n.getAttribute("width"),null!=d&&(l.width=d,this.cacheWidth=d),d=n.getAttribute("height"),null!=d&&(l.height=d,this.cacheHeight=d),d=n.getAttribute("frameX"),null!=d?(l.frameX=n.getAttribute("frameX"),this.cacheFrameX=l.frameX):l.frameX=0!=this.cacheFrameX?this.cacheFrameX:0,d=n.getAttribute("frameY"),null!=d?(l.frameY=d,this.cacheFrameY=l.frameY):l.frameY=0!=this.cacheFrameY?this.cacheFrameY:0,d=n.getAttribute("frameWidth"),null!=d?(l.frameWidth=d,this.cacheframeWidth=d):l.frameWidth=0!=this.cacheframeWidth?this.cacheframeWidth:this.cacheWidth,d=n.getAttribute("frameHeight"),null!=d?(l.frameHeight=d,this.cacheframeHeight=d):l.frameHeight=0!=this.cacheframeHeight?this.cacheframeHeight:this.cacheHeight,r.push(l)}this.quadResource.quadDataList=i}})}(),function(){ss2d.ParticleStyle=Class({loop:!1,tileName:null,gotoFrame:0,scopeX:10,scopeY:10,scaleX:1,scaleY:1,scaleXValue:-.01,scaleYValue:-.01,a:1,r:.5,g:.8,b:1,angleValue:0,rotationValue:-90*(Math.PI/180),rotationRandom:0,speedValue:5,alphaValue:-.02,addR:.3,addG:.02,addB:-.003,addA:-.004})}(),function(){ss2d.ParticleCPU=Class({quad:null,scaleXValue:0,scaleYValue:0,addR:0,addG:0,addB:0,addA:0,angleValue:0,rotationValue:0,speedValue:0,alphaValue:0,isStart:!1,initialize:function(t){this.quad=t,this.quad.GPU=!0,this.quad.setCenter(!0),this.quad.setVisible(!1)},paint:function(){this.rotationValue+=this.angleValue,this.quad.GPUX+=Math.cos(this.rotationValue)*this.speedValue,this.quad.GPUY+=Math.sin(this.rotationValue)*this.speedValue,this.quad.setScaleX(this.quad.getScaleX()+this.scaleXValue),this.quad.setScaleY(this.quad.getScaleY()+this.scaleYValue),this.quad.setAlpha(this.quad.getAlpha()+this.alphaValue),this.quad.setR(this.quad.getR()+this.addR),this.quad.setG(this.quad.getG()+this.addG),this.quad.setB(this.quad.getB()+this.addB),this.quad.setA(this.quad.getA()+this.addA),0>=this.quad.getAlpha()&&this.clear()},show:function(){this.quad.setAlpha(1),this.quad.setScaleX(1),this.quad.setScaleY(1),this.quad.setR(1),this.quad.setG(1),this.quad.setB(1),this.quad.setA(1),this.quad.setVisible(!0),this.isStart=!0},clear:function(){this.quad.setVisible(!1),this.isStart=!1}})}(),function(){ss2d.ParticleEmittersCPU=Class({isPlay:!0,frameRun:null,list:null,run:function(){this.paint()},initialize:function(t,e){this.list=[];for(var s=0;e>s;s++){var i=t.applyQuad();t.showQuad(i),i.setVisible(!1),i.loop(!0),i.play(),this.list.push(new ss2d.ParticleCPU(i))}this.frameRun=this.run.bind(this),ss2d.stage.addEventListener(ss2d.Event.ENTER_FRAME,this.frameRun)},paint:function(){for(var t=0;this.list.length>t;t++)this.list[t].isStart&&this.list[t].paint()},sendParticle:function(t,e,s){if(this.isPlay)for(var i=0;this.list.length>i;i++)if(0==this.list[i].isStart){var r=this.list[i];r.show(),r.quad.loop(s.loop),s.loop?r.quad.play():r.quad.stop(),0!=s.gotoFrame&&r.quad.gotoAndStop(s.gotoFrame),null!=s.tileName&&r.quad.setTileName(s.tileName),r.quad.setScaleX(s.scaleX),r.quad.setScaleY(s.scaleY),r.quad.GPUX=t+Math.random()*s.scopeX-s.scopeX/2,r.quad.GPUY=e+Math.random()*s.scopeY-s.scopeY/2,r.quad.setR(s.r),r.quad.setG(s.g),r.quad.setB(s.b),r.quad.setA(s.a),r.quad.setRotation(s.rotationValue),r.addR=s.addR,r.addG=s.addG,r.addB=s.addB,r.addA=s.addA,r.angleValue=s.angleValue,r.alphaValue=s.alphaValue,r.scaleXValue=s.scaleXValue,r.scaleYValue=s.scaleYValue,r.rotationValue=s.rotationValue+Math.random()*s.rotationRandom,r.speedValue=s.speedValue;break}}})}(),function(){ss2d.ShaderBasis=Class({basisVertexHead:null,basisVertexStart:null,basisVertexEnd:null,basisPixelHead:null,basisPixelStart:null,basisPixelEnd:null,vertexShader:null,fragmentShader:null,orMatrix:null,fuseMatrix3D:null,initialize:function(){this.orMatrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.basisVertexHead="precision mediump float;attribute vec2 aVertexPosition;attribute vec2 aTextureUV;attribute vec2 aVertexGPU;attribute vec4 aVertexColor;varying vec2 vTextureUV;varying vec4 vVertexColor;uniform mat4 oRMatrix;",this.basisVertexStart="void main(void) {",this.basisVertexEnd="vTextureUV = aTextureUV;vVertexColor=aVertexColor;gl_Position =  oRMatrix*vec4(aVertexPosition+aVertexGPU,1.0,1.0);}",this.basisPixelHead="precision mediump float;varying vec2 vTextureUV;varying vec4 vVertexColor;uniform sampler2D texture;",this.basisPixelStart="void main(void) {",this.basisPixelEnd="gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor;}"
},dispose:function(){ss2d.Stage2D.gl.deleteShader(this.vertexShader),ss2d.Stage2D.gl.deleteShader(this.fragmentShader),ss2d.Stage2D.gl.deleteProgram(this.shaderProgram),this.vertexShader=null,this.fragmentShader=null,this.shaderProgram=null},newShader:function(){this.shaderProgram=ss2d.Stage2D.gl.createProgram(),ss2d.Stage2D.gl.attachShader(this.shaderProgram,this.vertexShader),ss2d.Stage2D.gl.attachShader(this.shaderProgram,this.fragmentShader),ss2d.Stage2D.gl.linkProgram(this.shaderProgram),ss2d.Stage2D.gl.getProgramParameter(this.shaderProgram,ss2d.Stage2D.gl.LINK_STATUS)||alert("Could not initialise shaders"),ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.shaderProgram.vertexPositionAttribute=ss2d.Stage2D.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),ss2d.Stage2D.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.textureCoordAttribute=ss2d.Stage2D.gl.getAttribLocation(this.shaderProgram,"aTextureUV"),ss2d.Stage2D.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute),this.shaderProgram.vertexGPUAttribute=ss2d.Stage2D.gl.getAttribLocation(this.shaderProgram,"aVertexGPU"),ss2d.Stage2D.gl.enableVertexAttribArray(this.shaderProgram.vertexGPUAttribute),this.shaderProgram.verticesColourAttribute=ss2d.Stage2D.gl.getAttribLocation(this.shaderProgram,"aVertexColor"),ss2d.Stage2D.gl.enableVertexAttribArray(this.shaderProgram.verticesColourAttribute),ss2d.orthographicViewportMatrix(this.orMatrix,-ss2d.Stage2D.ratio-ss2d.Stage2D.ratio,ss2d.Stage2D.ratio-ss2d.Stage2D.ratio,2,0,0,1)},setTransform:function(t){this.fuseMatrix3D=t},upDataMatrix:function(){null!=this.fuseMatrix3D&&(ss2d.orthographicViewportMatrix(this.orMatrix,-ss2d.Stage2D.ratio-ss2d.Stage2D.ratio,ss2d.Stage2D.ratio-ss2d.Stage2D.ratio,2,0,0,1),this.orMatrix=this.fuseMatrix3D.add4x4(this.orMatrix,this.fuseMatrix3D.rawData))},upDataTexture:function(t){ss2d.Stage2D.gl.activeTexture(ss2d.Stage2D.gl.TEXTURE0),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,t.m_texture.texture),ss2d.Stage2D.gl.uniform1i(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"texture"),0)},upDataVertex:function(t){ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.verticesGPUBuffer),ss2d.Stage2D.gl.bufferData(ss2d.Stage2D.gl.ARRAY_BUFFER,t.m_verticesGPUList,ss2d.Stage2D.gl.STREAM_DRAW),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.vertexPositionBuffer),ss2d.Stage2D.gl.bufferData(ss2d.Stage2D.gl.ARRAY_BUFFER,t.m_verticesList,ss2d.Stage2D.gl.STREAM_DRAW),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.vertexTextureUvdBuffer),ss2d.Stage2D.gl.bufferData(ss2d.Stage2D.gl.ARRAY_BUFFER,t.m_uvList,ss2d.Stage2D.gl.STREAM_DRAW),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.verticesColorBuffer),ss2d.Stage2D.gl.bufferData(ss2d.Stage2D.gl.ARRAY_BUFFER,t.m_colorList,ss2d.Stage2D.gl.STREAM_DRAW),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ELEMENT_ARRAY_BUFFER,t.vertexIndexBuffer),ss2d.Stage2D.gl.bufferData(ss2d.Stage2D.gl.ELEMENT_ARRAY_BUFFER,t.m_indexList,ss2d.Stage2D.gl.STATIC_DRAW)},upDataCache:function(t){ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.verticesGPUBuffer),ss2d.Stage2D.gl.vertexAttribPointer(this.shaderProgram.vertexGPUAttribute,2,ss2d.Stage2D.gl.FLOAT,!1,0,0),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.vertexPositionBuffer),ss2d.Stage2D.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,2,ss2d.Stage2D.gl.FLOAT,!1,0,0),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.vertexTextureUvdBuffer),ss2d.Stage2D.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,ss2d.Stage2D.gl.FLOAT,!1,0,0),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.verticesColorBuffer),ss2d.Stage2D.gl.vertexAttribPointer(this.shaderProgram.verticesColourAttribute,4,ss2d.Stage2D.gl.FLOAT,!1,0,0),ss2d.Stage2D.gl.uniformMatrix4fv(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"oRMatrix"),!1,this.orMatrix)},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t)},getShader:function(t,e,s){var i;if("fs"==s)i=ss2d.Stage2D.gl.createShader(ss2d.Stage2D.gl.FRAGMENT_SHADER);else{if("vs"!=s)return null;i=ss2d.Stage2D.gl.createShader(ss2d.Stage2D.gl.VERTEX_SHADER)}return ss2d.Stage2D.gl.shaderSource(i,e),ss2d.Stage2D.gl.compileShader(i),ss2d.Stage2D.gl.getShaderParameter(i,ss2d.Stage2D.gl.COMPILE_STATUS)?i:(alert(ss2d.Stage2D.gl.getShaderInfoLog(i)),null)}})}(),function(){ss2d.ShaderGLSL=Class({Extends:ss2d.ShaderBasis,initialize:function(){ss2d.ShaderGLSL.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+this.basisPixelStart+this.basisPixelEnd,"fs"),this.newShader()}})}(),function(){ss2d.ShaderBlur=Class({Extends:ss2d.ShaderBasis,blurX:1.5,blurY:1.5,initialize:function(){ss2d.ShaderBlur.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform vec2 value;"+"uniform vec2 textureValue;"+"const float max=1.0;"+"void main()"+"{"+"vec4 vec4Sum = vec4(0.0);"+"for(float i=-max;i<=max;i+=1.0)"+"{"+"for(float j=-max;j<=max;j+=1.0)"+"{"+"vec2 xy_int = vec2(vTextureUV.x*textureValue.x  , vTextureUV.y*textureValue.y);"+"vec2 xy_new = vec2(xy_int.x+i*value.x, xy_int.y+j*value.y);"+"vec2 uv_new = vec2(xy_new.x/textureValue.x, xy_new.y/textureValue.y);"+"vec4Sum += texture2D(texture,uv_new)*vVertexColor;"+"};"+"};"+"gl_FragColor = vec4Sum*0.111;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),ss2d.Stage2D.gl.uniform2f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"textureValue"),t.m_texture.width,t._texture.height),ss2d.Stage2D.gl.uniform2f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"value"),this.blurX,this.blurY)}})}(),function(){ss2d.ShaderGray=Class({Extends:ss2d.ShaderBasis,initialize:function(){ss2d.ShaderGray.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"void main(void) {"+"gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor;"+"vec4 gray=vec4(1, 1, 1, 1);"+"vec4 grayValue=vec4(0.3,0.59,0.11,1.0);"+"gray.r=gl_FragColor.r*grayValue.x;"+"gray.g=gl_FragColor.g*grayValue.y;"+"gray.b=gl_FragColor.b*grayValue.z;"+"gray.a=gray.r+gray.g+gray.b;"+"gl_FragColor.r=gray.a;"+"gl_FragColor.g=gray.a;"+"gl_FragColor.b=gray.a;"+"}","fs"),this.newShader()}})}(),function(){ss2d.ShaderHdr=Class({Extends:ss2d.ShaderBasis,mLuminance:1.3,initialize:function(){ss2d.ShaderHdr.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float mLuminance;"+"vec4 xposure(vec4 _color , float gray , float ex) {"+"float b = ( 4.0 * ex -  1.0 );"+"float a = 1.0 - b;"+"float f = gray * ( a * gray + b );"+"return  _color*f;"+"}"+"void main(void) {"+"vec4 _dsColor = texture2D(texture , vTextureUV);"+"float _lum = 0.3 * _dsColor.x + 0.59 * _dsColor.y + 0.11* _dsColor.z;"+"vec4 vec4Sum = vec4(0.0);"+"for(float i=-1.0;i<=1.0;i+=1.0)"+"{"+"for(float j=-1.0;j<=1.0;j+=1.0)"+"{"+"vec2  intXY = vec2(vTextureUV.x * 1500.0 , vTextureUV.y * 1500.0);"+"vec2 _xy_new = vec2(intXY.x+i , intXY.y+j);"+"vec2 _uv_new = vec2(_xy_new.x/1500.0, _xy_new.y/1500.0);"+"vec4Sum += texture2D(texture,_uv_new);"+"};"+"};"+"vec4 _fColor = vec4Sum*(1.0/9.0);"+"gl_FragColor=xposure(_fColor,_lum,mLuminance)*vVertexColor;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"mLuminance"),this.mLuminance)}})}(),function(){ss2d.ShaderHeartbeat=Class({Extends:ss2d.ShaderBasis,time:1,initialize:function(){ss2d.ShaderHeartbeat.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float time;"+"const vec2 mouse=vec2(0.0,0.0);"+"const vec2 resolution=vec2(1024.0,768.0);"+"void main( void ) {"+"vec2 e;"+"vec2 p = ( gl_FragCoord.xy / resolution.xy ) - 0.5;"+"float sx = 0.2 * (p.x + 0.5) * sin( 25.0 * p.x - 10. * time);"+"float dy = 1./ ( 50. * abs(p.y - sx));"+"dy += 1./ (20. * length(p - vec2(p.x, 0.)));"+"gl_FragColor = texture2D(texture,vTextureUV)+vec4( (p.x + 0.5) * dy, 0.5 * dy, dy, 1.0 )*vVertexColor;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.time+=.1,ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"time"),this.time)}})}(),function(){ss2d.ShaderJoint=Class({Extends:ss2d.ShaderBasis,initialize:function(){ss2d.ShaderJoint.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+"varying vec2 jointListvarying;"+"attribute vec2 jointList;"+"void main(void) {"+"jointListvarying=jointList;"+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,"precision mediump float;varying vec2 vTextureUV;varying vec2 jointListvarying;varying vec4 vVertexColor;uniform sampler2D texture_0;uniform sampler2D texture_1;uniform sampler2D texture_2;uniform sampler2D texture_3;uniform sampler2D texture_4;uniform sampler2D texture_5;uniform sampler2D texture_6;uniform sampler2D texture_7;void main(void) {if(jointListvarying.x==0.0){gl_FragColor = texture2D(texture_0,vTextureUV)*vVertexColor;}else if(jointListvarying.x==1.0){gl_FragColor = texture2D(texture_1,vTextureUV)*vVertexColor;}else if(jointListvarying.x==2.0){gl_FragColor = texture2D(texture_2,vTextureUV)*vVertexColor;}else if(jointListvarying.x==3.0){gl_FragColor = texture2D(texture_3,vTextureUV)*vVertexColor;}else if(jointListvarying.x==4.0){gl_FragColor = texture2D(texture_4,vTextureUV)*vVertexColor;}else if(jointListvarying.x==5.0){gl_FragColor = texture2D(texture_5,vTextureUV)*vVertexColor;}else if(jointListvarying.x==6.0){gl_FragColor = texture2D(texture_6,vTextureUV)*vVertexColor;}else if(jointListvarying.x==7.0){gl_FragColor = texture2D(texture_7,vTextureUV)*vVertexColor;}}","fs"),this.newShader()},upDataShader:function(t){if(ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataVertex(t),this.upDataCache(t),t.m_isJoint)for(var e=0;t.m_texture.length>e;e++)ss2d.Stage2D.gl.activeTexture(ss2d.Stage2D.gl.TEXTURE0+e),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,t.m_texture[e].texture),ss2d.Stage2D.gl.uniform1i(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"texture_"+e),e);else ss2d.Stage2D.gl.activeTexture(ss2d.Stage2D.gl.TEXTURE0),ss2d.Stage2D.gl.bindTexture(ss2d.Stage2D.gl.TEXTURE_2D,t.m_texture.texture),ss2d.Stage2D.gl.uniform1i(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"texture_0"),0);ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.verticesJointBuffer),ss2d.Stage2D.gl.bufferData(ss2d.Stage2D.gl.ARRAY_BUFFER,t.m_jointList,ss2d.Stage2D.gl.STREAM_DRAW),ss2d.Stage2D.gl.bindBuffer(ss2d.Stage2D.gl.ARRAY_BUFFER,t.verticesJointBuffer),ss2d.Stage2D.gl.vertexAttribPointer(this.shaderProgram.verticesjointAttribute,2,ss2d.Stage2D.gl.FLOAT,!1,0,0)}})}(),function(){ss2d.ShaderLaser=Class({Extends:ss2d.ShaderBasis,time:1,initialize:function(){ss2d.ShaderLaser.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float time;"+"const vec2 mouse=vec2(0.0,0.0);"+"const vec2 resolution=vec2(1024.0,768.0);"+"const vec3 ORANGE = vec3(1.4, 0.8, 0.4);"+"const vec3 BLUE = vec3(0.5, 0.9, 1.3);"+"const vec3 GREEN = vec3(0.9, 1.4, 0.4);"+"const vec3 RED = vec3(1.8, 0.4, 0.3);"+"void main() {"+"float x, y, xpos, ypos;"+"float t = time * 10.0;"+"vec3 c = vec3(0.0);"+"xpos = (gl_FragCoord.x / resolution.x);"+"ypos = (gl_FragCoord.y / resolution.y);"+"x = xpos;"+"for (float i = 0.0; i < 8.0; i += 1.0){"+"for(float j = 0.0; j < 2.0; j += 1.0){"+"y = ypos"+"+ (0.30 * sin(x * 2.000 +( i * 1.5 + j) * 0.4 + t * 0.050)"+"+ 0.100 * cos(x * 6.350 + (i  + j) * 0.7 + t * 0.050 * j)"+"+ 0.024 * sin(x * 12.35 + ( i + j * 4.0 ) * 0.8 + t * 0.034 * (8.0 *  j))"+"+ 0.5);"+"c += vec3(1.0 - pow(clamp(abs(1.0 - y) * 5.0, 0.0,1.0), 0.25));"+"}"+"}"+"c *= mix("+"mix(ORANGE, BLUE, xpos)"+", mix(GREEN, RED, xpos)"+",(sin(t * 0.02) + 1.0) * 0.45"+") * 0.5;"+"gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor+vec4(c,1.0);"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.time+=.1,ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"time"),this.time)}})}(),function(){ss2d.ShaderLight=Class({Extends:ss2d.ShaderBasis,lightX:.5,lightY:-.5,lightScale:10,initialize:function(){ss2d.ShaderLight.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform vec3 lightingValue;"+"void main() {"+"vec3 lighting=vec3(1, 1, 1);"+"lighting.x=abs(lightingValue.x-vTextureUV.x);"+"lighting.y=abs(lightingValue.y-vTextureUV.y);"+"lighting.z=sqrt(lighting.x*lighting.x+lighting.y*lighting.y);"+"gl_FragColor=texture2D(texture,vTextureUV)/(lighting.z*lightingValue.z)*vVertexColor;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),ss2d.Stage2D.gl.uniform3f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"lightingValue"),this.lightX,this.lightY,this.lightScale)}})}(),function(){ss2d.ShaderMosaic=Class({Extends:ss2d.ShaderBasis,noisy:10,initialize:function(){ss2d.ShaderMosaic.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform vec3 value;"+"void main(void) {"+"vec2  intXY = vec2(vTextureUV.x * value.x , vTextureUV.y * value.y);"+"vec2  XYMosaic = vec2(ceil(intXY.x/value.z) *value.z,ceil(intXY.y/value.z) * value.z);"+"vec2  UVMosaic = vec2(XYMosaic.x/value.x , XYMosaic.y/value.y);"+"gl_FragColor=texture2D(texture,UVMosaic)*vVertexColor;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),ss2d.Stage2D.gl.uniform3f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"value"),t.m_texture.width,t.m_texture.height,this.noisy)}})}(),function(){ss2d.ShaderNet=Class({Extends:ss2d.ShaderBasis,time:1,initialize:function(){ss2d.ShaderNet.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float time;"+"const vec2 mouse=vec2(0.0,0.0);"+"const vec2 resolution=vec2(1024.0,768.0);"+"const vec3 ORANGE = vec3(1.4, 0.1, 0.3);"+"const vec3 BLUE = vec3(0.5, 0.1, 1.3);"+"const vec3 GREEN = vec3(1.0, 0.4, 0.4);"+"const vec3 RED = vec3(1.8, 0.4, 0.8);"+"void main() {"+"float x, y, xpos, ypos;"+"float t = time * 1.5;"+"vec3 c = vec3(0.0);"+"ypos = (gl_FragCoord.x / resolution.x);"+"xpos = (gl_FragCoord.y / resolution.y);"+"x = xpos;"+"for (float i = 0.0; i < 8.0; i += 1.0) {"+"for(float j = 0.0; j < 2.0; j += 1.0){"+"y = ypos"+"+ (0.30 * sin(x * 2.000 +( i * 1.5 + j) * 0.4 + t * 0.050)"+"+ 0.100 * cos(x * 6.350 + (i  + j) * 0.7 + t * 0.050 * j)"+"+ 0.024 * sin(x * 12.35 + ( i + j * 4.0 ) * 0.8 + t * 0.034 * (8.0 *  j))"+"+ 0.5);"+"c += vec3(1.0 - pow(clamp(abs(1.0 - y) * 5.0, 0.0,1.0), 0.25));"+"}"+"}"+"c *= mix("+"mix(ORANGE, BLUE, xpos)"+", mix(GREEN, RED, xpos)"+",(sin(t * 0.02) + 1.0) * 0.45"+") * 0.5;"+"gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor+vec4(c,1.0);"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.time+=.1,ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"time"),this.time)}})}(),function(){ss2d.ShaderQuick=Class({Extends:ss2d.ShaderBasis,initialize:function(){ss2d.ShaderQuick.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,"precision mediump float;varying vec2 vTextureUV;varying vec4 vVertexColor;uniform sampler2D texture;void main(void) {gl_FragColor = texture2D(texture,vTextureUV);}","fs"),this.newShader()}})}(),function(){ss2d.ShaderRelief=Class({Extends:ss2d.ShaderBasis,initialize:function(){ss2d.ShaderRelief.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"void main(void) {"+"vec2  upLeftUV = vec2(vTextureUV.x - 1.0/1.01 , vTextureUV.y - 1.0/1.01);"+"vec4  bkColor = vec4(0.5 , 0.5 , 0.5 , 1.0);"+"vec4  curColor    =  texture2D(texture,vTextureUV);"+"vec4  upLeftColor =  texture2D(texture,upLeftUV);"+"vec4  delColor = curColor - upLeftColor;"+"vec2  h = vec2(0.3 * delColor.x + 0.59 * delColor.y + 0.11* delColor.z,0.0);"+"gl_FragColor =  vec4(h.x,h.x,h.x,0.0)+bkColor;"+"}","fs"),this.newShader()}})}(),function(){ss2d.ShaderFigure=Class({Extends:ss2d.ShaderBasis,time:1,initialize:function(){ss2d.ShaderFigure.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float time;"+"const vec2 mouse=vec2(0.0,0.0);"+"const vec2 resolution=vec2(1024.0,768.0);"+"void main() {"+"vec2 position = vec2("+"mod(gl_FragCoord.x, 64.0),"+"mod(gl_FragCoord.y, 64.0)"+");"+"float xang = 10.0*time + (gl_FragCoord.y / 20.0);"+"float zang = 10.0*time + (gl_FragCoord.x / 20.0);"+"vec3 whatamidoing = vec3("+"sin(xang)+cos(gl_FragCoord.x/6.0) /2.0 + 0.5,"+"sin(mod(time*4.0, 2.0*3.14159265))/2.0 + 0.5,"+"cos(zang)+sin(gl_FragCoord.y/6.0) /2.0 + 0.5"+");"+"gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor+vec4(whatamidoing, 1.0);"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.time+=.01,ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"time"),this.time)}})}(),function(){ss2d.ShaderGlass=Class({Extends:ss2d.ShaderBasis,timer:0,speed:10,frequency:200,resolution:30,noisy:.009,initialize:function(){ss2d.ShaderGlass.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform vec4 value;"+"void main(void) {"+"vec2 backgroundUv = vTextureUV;"+"backgroundUv.x =backgroundUv.x+sin(value.w /value.x + backgroundUv.x *value.y) *value.z;"+"backgroundUv.y =backgroundUv.y+cos(value.w /value.x + backgroundUv.y *value.y) *value.z;"+"gl_FragColor=texture2D(texture,backgroundUv)*vVertexColor;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.timer+=this.speed,ss2d.Stage2D.gl.uniform4f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"value"),this.frequency,this.resolution,this.noisy,this.timer)}})}(),function(){ss2d.ShaderFractal=Class({Extends:ss2d.ShaderBasis,time:1,initialize:function(){ss2d.ShaderFractal.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float time;"+"const vec2 mouse=vec2(0.0,0.0);"+"const vec2 resolution=vec2(1024.0,768.0);"+"vec2 CircleInversion(vec2 vPos, vec2 vOrigin, float fRadius)"+"{"+"vec2 vOP = vPos - vOrigin;"+"vOrigin = vOrigin - vOP * fRadius * fRadius / dot(vOP, vOP);"+"vOrigin.x += sin(vOrigin.x * 0.01);"+"vOrigin.y -= cos(vOrigin.y* 0.01);"+"return vOrigin;"+"}"+"float Parabola( float x, float n )"+"{"+"return pow( 2.0*x*(1.0-x), n );"+"}"+"void main(void)"+"{"+"vec2 vPos = gl_FragCoord.xy / resolution.xy;"+"vPos = vPos - 0.5;"+"vPos.x *= resolution.x / resolution.y;"+"vec2 vScale = vec2(1.2);"+"vec2 vOffset = vec2( sin(time * 0.123), atan(time * 0.0567));"+"float l = 0.0;"+"float minl = 10000.0;"+"for(int i=0; i<48; i++)"+"{"+"vPos.x = abs(vPos.x);"+"vPos = vPos * vScale + vOffset;"+"vPos = CircleInversion(vPos, vec2(0.5, 0.5), 0.9);"+"l = length(vPos);"+"minl = min(l, minl);"+"}"+"float t = 4.1 + time * 0.055;"+"vec3 vBaseColour = normalize(vec3(sin(t * 1.790), sin(t * 1.345), sin(t * 1.123)) * 0.5 + 0.5);"+"float fBrightness = 11.0;"+"vec3 vColour = vBaseColour * l * l * fBrightness;"+"minl = Parabola(minl, 5.0);"+"vColour *= minl + 0.1;"+"vColour = 1.0 - exp(-vColour);"+"gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor+vec4(vColour,1.0);"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.time+=.1,ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"time"),this.time)}})}(),function(){ss2d.ShaderAdvanced=Class({Extends:ss2d.ShaderBasis,r:0,g:0,b:0,a:0,initialize:function(){ss2d.ShaderAdvanced.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform vec4 value;"+"void main(void) {"+"gl_FragColor = texture2D(texture,vTextureUV)*vVertexColor+value;"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),ss2d.Stage2D.gl.uniform4f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"value"),this.r,this.g,this.b,this.a)}})}(),function(){ss2d.ShaderAbstract=Class({Extends:ss2d.ShaderBasis,time:0,initialize:function(){this.time=0,ss2d.ShaderAbstract.Super.call(this),this.vertexShader=this.getShader(ss2d.Stage2D.gl,this.basisVertexHead+this.basisVertexStart+this.basisVertexEnd,"vs"),this.fragmentShader=this.getShader(ss2d.Stage2D.gl,this.basisPixelHead+"uniform float time;"+"const vec2 mouse=vec2(0.0,0.0);"+"const vec2 resolution=vec2(1024.0,1024.0);"+"void main(void)"+"{"+"float scale = resolution.y / 50.0;"+"float ring = 20.0;"+"float radius = resolution.x*1.0;"+"float gap = scale*.5;"+"vec2 pos = gl_FragCoord.xy - resolution.xy*.5;"+"float d = length(pos);"+"d += mouse.x*(sin(pos.y*0.25/scale+time)*sin(pos.x*0.25/scale+time*.5))*scale*5.0;"+"float v = mod(d + radius/(ring*2.0), radius/ring);"+"v = abs(v - radius/(ring*2.0));"+"v = clamp(v-gap, 0.0, 1.0);"+"d /= radius;"+"vec3 m = fract((d-1.0)*vec3(ring*-.5, -ring, ring*.25)*0.5);"+"gl_FragColor = texture2D(texture,vTextureUV)*vec4(m*v, 1.0);"+"}","fs"),this.newShader()},upDataShader:function(t){ss2d.Stage2D.gl.useProgram(this.shaderProgram),this.upDataMatrix(),this.upDataTexture(t),this.upDataVertex(t),this.upDataCache(t),this.time+=.01,ss2d.Stage2D.gl.uniform1f(ss2d.Stage2D.gl.getUniformLocation(this.shaderProgram,"time"),this.time)}})}(),function(){ss2d.AbstractLoader=Class({Extends:ss2d.EventDispatcher,STATIC:{FILE_PATTERN:/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?)|(.{0,2}\/{1}))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,PATH_PATTERN:/^(?:(\w+:)\/{2})|(.{0,2}\/{1})?([/.]*?(?:[^?]+)?\/?)?$/},_item:null,loaded:!1,canceled:!1,progress:0,initialize:function(){},getItem:function(){return this._item},load:function(){},close:function(){},buildPath:function(t,e){if(null==e)return t;var s=[],i=t.indexOf("?");if(-1!=i){var r=t.slice(i+1);s=s.concat(r.split("&"))}return-1!=i?t.slice(0,i)+"?"+this._formatQueryString(e,s):t+"?"+this._formatQueryString(e,s)},_isCanceled:function(){return null==window.ss2d||this.canceled?!0:!1},_sendLoadStart:function(){this._isCanceled()||this.dispatchEvent("loadstart")},_sendProgress:function(t){if(!this._isCanceled()){var e=null;"number"==typeof t?(this.progress=t,e=new ss2d.Event("progress"),e.loaded=this.progress,e.total=1):(e=t,this.progress=t.loaded/t.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),e.progress=this.progress,this.hasEventListener("progress")&&this.dispatchEvent(e)}},_sendComplete:function(){this._isCanceled()||this.dispatchEvent("complete")},_sendError:function(t){!this._isCanceled()&&this.hasEventListener("error")&&(null==t&&(t=new ss2d.Event("error")),this.dispatchEvent(t))},_parseURI:function(t){return t?t.match(ss2d.AbstractLoader.FILE_PATTERN):null},_parsePath:function(t){return t?t.match(ss2d.AbstractLoader.PATH_PATTERN):null},_formatQueryString:function(t,e){if(null==t)throw Error("You must specify data.");var s=[];for(var i in t)s.push(i+"="+escape(t[i]));return e&&(s=s.concat(e)),s.join("&")},_isCrossDomain:function(t){var e=document.createElement("a");e.href=t.src;var s=document.createElement("a");s.href=location.href;var i=""!=e.hostname&&(e.port!=s.port||e.protocol!=s.protocol||e.hostname!=s.hostname);return i},_isLocal:function(t){var e=document.createElement("a");return e.href=t.src,""==e.hostname&&"file:"==e.protocol}})}(),function(){ss2d.LoadQueue=Class({Extends:ss2d.AbstractLoader,STATIC:{LOAD_TIMEOUT:0,BINARY:"binary",CSS:"css",IMAGE:"image",JAVASCRIPT:"javascript",JSON:"json",JSONP:"jsonp",MANIFEST:"manifest",SOUND:"sound",SVG:"svg",TEXT:"text",XML:"xml",HTML:"html",POST:"POST",GET:"GET",loadTimeout:8e3,isBinary:function(t){switch(t){case this.IMAGE:case this.BINARY:return!0;default:return!1}},isText:function(t){switch(t){case this.TEXT:case this.JSON:case this.MANIFEST:case this.XML:case this.HTML:case this.CSS:case this.SVG:case this.JAVASCRIPT:return!0;default:return!1}}},_basePath:null,_crossOrigin:"",_typeCallbacks:null,_extensionCallbacks:null,_loadStartWasDispatched:!1,_maxConnections:1,_currentlyLoadingScript:null,_currentLoads:null,_loadQueue:null,_loadQueueBackup:null,_loadItemsById:null,_loadItemsBySrc:null,_loadedResults:null,_loadedRawResults:null,_numItems:0,_numItemsLoaded:0,_scriptOrder:null,_loadedScripts:null,_paused:!1,useXHR:!0,stopOnError:!1,maintainScriptOrder:!0,next:null,initialize:function(t,e,s){this._numItems=this._numItemsLoaded=0,this._paused=!1,this._loadStartWasDispatched=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=e,this.setUseXHR(t),this._crossOrigin=s===!0?"Anonymous":s===!1||null==s?"":s},setUseXHR:function(t){return this.useXHR=0!=t&&null!=window.XMLHttpRequest,this.useXHR},removeAll:function(){this.remove()},remove:function(t){var e=null;if(!t||t instanceof Array){if(t)e=t;else if(arguments.length>0)return}else e=[t];var s=!1;if(e){for(;e.length;){var i=e.pop(),r=this.getResult(i);for(a=this._loadQueue.length-1;a>=0;a--)if(n=this._loadQueue[a].getItem(),n.id==i||n.src==i){this._loadQueue.splice(a,1)[0].cancel();break}for(a=this._loadQueueBackup.length-1;a>=0;a--)if(n=this._loadQueueBackup[a].getItem(),n.id==i||n.src==i){this._loadQueueBackup.splice(a,1)[0].cancel();break}if(r)delete this._loadItemsById[r.id],delete this._loadItemsBySrc[r.src],this._disposeItem(r);else for(var a=this._currentLoads.length-1;a>=0;a--){var n=this._currentLoads[a].getItem();if(n.id==i||n.src==i){this._currentLoads.splice(a,1)[0].cancel(),s=!0;break}}}s&&this._loadNext()}else{this.close();for(var o in this._loadItemsById)this._disposeItem(this._loadItemsById[o]);this.init(this.useXHR)}},reset:function(){this.close();for(var t in this._loadItemsById)this._disposeItem(this._loadItemsById[t]);for(var e=[],s=0,i=this._loadQueueBackup.length;i>s;s++)e.push(this._loadQueueBackup[s].getItem());this.loadManifest(e,!1)},installPlugin:function(t){if(null!=t&&null!=t.getPreloadHandlers){var e=t.getPreloadHandlers();if(e.scope=t,null!=e.types)for(var s=0,i=e.types.length;i>s;s++)this._typeCallbacks[e.types[s]]=e;if(null!=e.extensions)for(s=0,i=e.extensions.length;i>s;s++)this._extensionCallbacks[e.extensions[s]]=e}},setMaxConnections:function(t){this._maxConnections=t,!this._paused&&this._loadQueue.length>0&&this._loadNext()},loadFile:function(t,e,s){if(null==t){var i=new ss2d.Event("error");return i.text="PRELOAD_NO_FILE",this._sendError(i),void 0}this._addItem(t,null,s),e!==!1?this.setPaused(!1):this.setPaused(!0)},loadManifest:function(t,e,s){var i=null,r=null;if(t instanceof Array){if(0==t.length){var a=new ss2d.Event("error");return a.text="PRELOAD_MANIFEST_EMPTY",this._sendError(a),void 0}i=t}else if("string"==typeof t)i=[{src:t,type:ss2d.LoadQueue.MANIFEST}];else{if("object"!=typeof t){var a=new ss2d.Event("error");return a.text="PRELOAD_MANIFEST_NULL",this._sendError(a),void 0}if(void 0!==t.src){if(null==t.type)t.type=ss2d.LoadQueue.MANIFEST;else if(t.type!=ss2d.LoadQueue.MANIFEST){var a=new ss2d.Event("error");a.text="PRELOAD_MANIFEST_ERROR",this._sendError(a)}i=[t]}else void 0!==t.manifest&&(i=t.manifest,r=t.path)}for(var n=0,o=i.length;o>n;n++)this._addItem(i[n],r,s);e!==!1?this.setPaused(!1):this.setPaused(!0)},load:function(){this.setPaused(!1)},getItem:function(t){return this._loadItemsById[t]||this._loadItemsBySrc[t]},getResult:function(t,e){var s=this._loadItemsById[t]||this._loadItemsBySrc[t];if(null==s)return null;var i=s.id;return e&&this._loadedRawResults[i]?this._loadedRawResults[i]:this._loadedResults[i]},setPaused:function(t){this._paused=t,this._paused||this._loadNext()},close:function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},_addItem:function(t,e,s){var i=this._createLoadItem(t,e,s);if(null!=i){var r=this._createLoader(i);null!=r&&(this._loadQueue.push(r),this._loadQueueBackup.push(r),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&i.type==ss2d.LoadQueue.JAVASCRIPT&&r instanceof ss2d.XHRLoader&&(this._scriptOrder.push(i),this._loadedScripts.push(null)))}},_createLoadItem:function(t,e,s){var i=null;switch(typeof t){case"string":i={src:t};break;case"object":i=window.HTMLAudioElement&&t instanceof window.HTMLAudioElement?{tag:t,src:i.tag.src,type:ss2d.LoadQueue.SOUND}:t;break;default:return null}var r=this._parseURI(i.src);null!=r&&(i.ext=r[6]),null==i.type&&(i.type=this._getTypeByExtension(i.ext));var a="",n=s||this._basePath,o=i.src;if(r&&null==r[1]&&null==r[3])if(e){a=e;var h=this._parsePath(e);o=e+o,null!=n&&h&&null==h[1]&&null==h[2]&&(a=n+a)}else null!=n&&(a=n);if(i.src=a+i.src,i.path=a,(i.type==ss2d.LoadQueue.JSON||i.type==ss2d.LoadQueue.MANIFEST)&&(i._loadAsJSONP=null!=i.callback),i.type==ss2d.LoadQueue.JSONP&&null==i.callback)throw Error("callback is required for loading JSONP requests.");
(void 0===i.tag||null===i.tag)&&(i.tag=this._createTag(i)),(void 0===i.id||null===i.id||""===i.id)&&(i.id=o);var u=this._typeCallbacks[i.type]||this._extensionCallbacks[i.ext];if(u){var l=u.callback.call(u.scope,i.src,i.type,i.id,i.data,a,this);if(l===!1)return null;l===!0||(null!=l.src&&(i.src=l.src),null!=l.id&&(i.id=l.id),null!=l.tag&&(i.tag=l.tag),null!=l.completeHandler&&(i.completeHandler=l.completeHandler),l.type&&(i.type=l.type),r=this._parseURI(i.src),null!=r&&null!=r[6]&&(i.ext=r[6].toLowerCase()))}return this._loadItemsById[i.id]=i,this._loadItemsBySrc[i.src]=i,i},_createLoader:function(t){var e=this.useXHR;switch(t.type){case ss2d.LoadQueue.JSON:case ss2d.LoadQueue.MANIFEST:e=!t._loadAsJSONP;break;case ss2d.LoadQueue.XML:case ss2d.LoadQueue.TEXT:e=!0;break;case ss2d.LoadQueue.SOUND:case ss2d.LoadQueue.JSONP:e=!1;break;case null:return null}return e?new ss2d.XHRLoader(t,this._crossOrigin):new ss2d.TagLoader(t)},_loadNext:function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var t=0;this._loadQueue.length>t&&!(this._currentLoads.length>=this._maxConnections);t++){var e=this._loadQueue[t];if(this.maintainScriptOrder&&e instanceof ss2d.TagLoader&&e.getItem().type==ss2d.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(t,1),t--,this._loadItem(e)}}},_loadItem:function(t){t.on("progress",this._handleProgress,this),t.on("complete",this._handleFileComplete,this),t.on("error",this._handleFileError,this),this._currentLoads.push(t),this._sendFileStart(t.getItem()),t.load()},_handleFileError:function(t){var e=t.target;this._numItemsLoaded++,this._updateProgress();var s=new ss2d.Event("error");s.text="FILE_LOAD_ERROR",s.item=e.getItem(),this._sendError(s),this.stopOnError||(this._removeLoadItem(e),this._loadNext())},_handleFileComplete:function(t){var e=t.target,s=e.getItem();if(this._loadedResults[s.id]=e.getResult(),e instanceof ss2d.XHRLoader&&(this._loadedRawResults[s.id]=e.getResult(!0)),this._removeLoadItem(e),this.maintainScriptOrder&&s.type==ss2d.LoadQueue.JAVASCRIPT){if(!(e instanceof ss2d.TagLoader))return this._loadedScripts[ss2d.indexOf(this._scriptOrder,s)]=s,this._checkScriptLoadOrder(e),void 0;this._currentlyLoadingScript=!1}if(delete s._loadAsJSONP,s.type==ss2d.LoadQueue.MANIFEST){var i=e.getResult();null!=i&&void 0!==i.manifest&&this.loadManifest(i,!0)}this._processFinishedLoad(s,e)},_processFinishedLoad:function(t,e){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(t,e),this._loadNext()},_checkScriptLoadOrder:function(){for(var t=this._loadedScripts.length,e=0;t>e;e++){var s=this._loadedScripts[e];if(null===s)break;if(s!==!0){var i=this._loadedResults[s.id];(document.body||document.getElementsByTagName("body")[0]).appendChild(i),this._processFinishedLoad(s),this._loadedScripts[e]=!0}}},_removeLoadItem:function(t){for(var e=this._currentLoads.length,s=0;e>s;s++)if(this._currentLoads[s]==t){this._currentLoads.splice(s,1);break}},_handleProgress:function(t){var e=t.target;this._sendFileProgress(e.getItem(),e.progress),this._updateProgress()},_updateProgress:function(){var t=this._numItemsLoaded/this._numItems,e=this._numItems-this._numItemsLoaded;if(e>0){for(var s=0,i=0,r=this._currentLoads.length;r>i;i++)s+=this._currentLoads[i].progress;t+=s/e*(e/this._numItems)}this._sendProgress(t)},_disposeItem:function(t){delete this._loadedResults[t.id],delete this._loadedRawResults[t.id],delete this._loadItemsById[t.id],delete this._loadItemsBySrc[t.src]},_createTag:function(t){var e=null;switch(t.type){case ss2d.LoadQueue.IMAGE:return e=document.createElement("img"),""==this._crossOrigin||this._isLocal(t)||(e.crossOrigin=this._crossOrigin),e;case ss2d.LoadQueue.SOUND:return e=document.createElement("audio"),e.autoplay=!1,e;case ss2d.LoadQueue.JSON:case ss2d.LoadQueue.JSONP:case ss2d.LoadQueue.JAVASCRIPT:case ss2d.LoadQueue.MANIFEST:return e=document.createElement("script"),e.type="text/javascript",e;case ss2d.LoadQueue.CSS:return e=this.useXHR?document.createElement("style"):document.createElement("link"),e.rel="stylesheet",e.type="text/css",e;case ss2d.LoadQueue.SVG:return this.useXHR?e=document.createElement("svg"):(e=document.createElement("object"),e.type="image/svg+xml"),e}return null},_getTypeByExtension:function(t){if(null==t)return ss2d.LoadQueue.TEXT;switch(t.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return ss2d.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return ss2d.LoadQueue.SOUND;case"json":return ss2d.LoadQueue.JSON;case"xml":return ss2d.LoadQueue.XML;case"css":return ss2d.LoadQueue.CSS;case"js":return ss2d.LoadQueue.JAVASCRIPT;case"svg":return ss2d.LoadQueue.SVG;default:return ss2d.LoadQueue.TEXT}},_sendFileProgress:function(t,e){if(this._isCanceled())return this._cleanUp(),void 0;if(this.hasEventListener("fileprogress")){var s=new ss2d.Event("fileprogress");s.progress=e,s.loaded=e,s.total=1,s.item=t,this.dispatchEvent(s)}},_sendFileComplete:function(t,e){if(!this._isCanceled()){var s=new ss2d.Event("fileload");s.loader=e,s.item=t,s.result=this._loadedResults[t.id],s.rawResult=this._loadedRawResults[t.id],t.completeHandler&&t.completeHandler(s),this.hasEventListener("fileload")&&this.dispatchEvent(s)}},_sendFileStart:function(t){var e=new ss2d.Event("filestart");e.item=t,this.hasEventListener("filestart")&&this.dispatchEvent(e)}})}(),function(){ss2d.SamplePlugin=Class({STATIC:{preloadHandler:function(){},fileLoadHandler:function(){},getPreloadHandlers:function(){return{callback:this.preloadHandler,types:["image"],extensions:["jpg","jpeg","png","gif"]}}},initialize:function(){throw"SamplePlugin cannot be instantiated"}})}(),function(){ss2d.TagLoader=Class({Extends:ss2d.AbstractLoader,_loadTimeout:null,_tagCompleteProxy:null,_isAudio:!1,_tag:null,_jsonResult:null,initialize:function(t){this._item=t,this._tag=t.tag,this._isAudio=window.HTMLAudioElement&&t.tag instanceof window.HTMLAudioElement,this._tagCompleteProxy=ss2d.proxy(this._handleLoad,this)},getResult:function(){return this._item.type==ss2d.LoadQueue.JSONP||this._item.type==ss2d.LoadQueue.MANIFEST?this._jsonResult:this._tag},cancel:function(){this.canceled=!0,this._clean()},load:function(){var t=this._item,e=this._tag;clearTimeout(this._loadTimeout);var s=ss2d.LoadQueue.LOAD_TIMEOUT;0==s&&(s=ss2d.LoadQueue.loadTimeout),this._loadTimeout=setTimeout(ss2d.proxy(this._handleTimeout,this),s),this._isAudio&&(e.src=null,e.preload="auto"),e.onerror=ss2d.proxy(this._handleError,this),this._isAudio?(e.onstalled=ss2d.proxy(this._handleStalled,this),e.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(e.onload=ss2d.proxy(this._handleLoad,this),e.onreadystatechange=ss2d.proxy(this._handleReadyStateChange,this));var i=this.buildPath(t.src,t.values);switch(t.type){case ss2d.LoadQueue.CSS:e.href=i;break;case ss2d.LoadQueue.SVG:e.data=i;break;default:e.src=i}if(t.type==ss2d.LoadQueue.JSONP||t.type==ss2d.LoadQueue.JSON||t.type==ss2d.LoadQueue.MANIFEST){if(null==t.callback)throw Error("callback is required for loading JSONP requests.");if(null!=window[t.callback])throw Error('JSONP callback "'+t.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[t.callback]=ss2d.proxy(this._handleJSONPLoad,this)}(t.type==ss2d.LoadQueue.SVG||t.type==ss2d.LoadQueue.JSONP||t.type==ss2d.LoadQueue.JSON||t.type==ss2d.LoadQueue.MANIFEST||t.type==ss2d.LoadQueue.JAVASCRIPT||t.type==ss2d.LoadQueue.CSS)&&(this._startTagVisibility=e.style.visibility,e.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(e)),null!=e.load&&e.load()},_handleJSONPLoad:function(t){this._jsonResult=t},_handleTimeout:function(){this._clean();var t=new ss2d.Event("error");t.text="PRELOAD_TIMEOUT",this._sendError(t)},_handleStalled:function(){},_handleError:function(){this._clean();var t=new ss2d.Event("error");this._sendError(t)},_handleReadyStateChange:function(){clearTimeout(this._loadTimeout);var t=this.getItem().tag;("loaded"==t.readyState||"complete"==t.readyState)&&this._handleLoad()},_handleLoad:function(){if(!this._isCanceled()){var t=this.getItem(),e=t.tag;if(!(this.loaded||this._isAudio&&4!==e.readyState)){switch(this.loaded=!0,t.type){case ss2d.LoadQueue.SVG:case ss2d.LoadQueue.JSON:case ss2d.LoadQueue.JSONP:case ss2d.LoadQueue.MANIFEST:case ss2d.LoadQueue.CSS:e.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(e);break;default:}this._clean(),this._sendComplete()}}},_clean:function(){clearTimeout(this._loadTimeout);var t=this.getItem(),e=t.tag;null!=e&&(e.onload=null,e.removeEventListener&&e.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),e.onstalled=null,e.onprogress=null,e.onerror=null,null!=e.parentNode&&t.type==ss2d.LoadQueue.SVG&&t.type==ss2d.LoadQueue.JSON&&t.type==ss2d.LoadQueue.MANIFEST&&t.type==ss2d.LoadQueue.CSS&&t.type==ss2d.LoadQueue.JSONP&&e.parentNode.removeChild(e));var t=this.getItem();(t.type==ss2d.LoadQueue.JSONP||t.type==ss2d.LoadQueue.MANIFEST)&&(window[t.callback]=null)}})}(),function(){ss2d.XHRLoader=Class({Extends:ss2d.AbstractLoader,_request:null,_loadTimeout:null,_xhrLevel:1,_response:null,_rawResponse:null,_crossOrigin:"",initialize:function(t,e){this._item=t,this._crossOrigin=e,!this._createXHR(t)},getResult:function(t){return t&&this._rawResponse?this._rawResponse:this._response},cancel:function(){this.canceled=!0,this._clean(),this._request.abort()},load:function(){if(null==this._request)return this._handleError(),void 0;if(this._request.onloadstart=ss2d.proxy(this._handleLoadStart,this),this._request.onprogress=ss2d.proxy(this._handleProgress,this),this._request.onabort=ss2d.proxy(this._handleAbort,this),this._request.onerror=ss2d.proxy(this._handleError,this),this._request.ontimeout=ss2d.proxy(this._handleTimeout,this),1==this._xhrLevel){var t=ss2d.LoadQueue.LOAD_TIMEOUT;if(0==t)t=ss2d.LoadQueue.loadTimeout;else try{console.warn("LoadQueue.LOAD_TIMEOUT has been deprecated in favor of LoadQueue.loadTimeout")}catch(e){}this._loadTimeout=setTimeout(ss2d.proxy(this._handleTimeout,this),t)}this._request.onload=ss2d.proxy(this._handleLoad,this),this._request.onreadystatechange=ss2d.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=ss2d.LoadQueue.GET?this._item.method==ss2d.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(s){var i=new ss2d.Event("error");i.error=s,this._sendError(i)}},getAllResponseHeaders:function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},getResponseHeader:function(t){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(t):null},_handleProgress:function(t){if(t&&!(t.loaded>0&&0==t.total)){var e=new ss2d.Event("progress");e.loaded=t.loaded,e.total=t.total,this._sendProgress(e)}},_handleLoadStart:function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},_handleAbort:function(){this._clean();var t=new ss2d.Event("error");t.text="XHR_ABORTED",this._sendError(t)},_handleError:function(){this._clean();var t=new ss2d.Event("error");this._sendError(t)},_handleReadyStateChange:function(){4==this._request.readyState&&this._handleLoad()},_handleLoad:function(){if(!this.loaded){if(this.loaded=!0,!this._checkError())return this._handleError(),void 0;this._response=this._getResponse(),this._clean();var t=this._generateTag();t&&this._sendComplete()}},_handleTimeout:function(t){this._clean();var e=new ss2d.Event("error");e.text="PRELOAD_TIMEOUT",this._sendError(t)},_checkError:function(){var t=parseInt(this._request.status);switch(t){case 404:case 0:return!1}return!0},_getResponse:function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(t){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(t){}return null},_createXHR:function(t){var e=this._isCrossDomain(t),s=null;if(e&&window.XDomainRequest)s=new XDomainRequest;else if(window.XMLHttpRequest)s=new XMLHttpRequest;else try{s=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(i){try{s=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(i){try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){return!1}}}ss2d.LoadQueue.isText(t.type)&&s.overrideMimeType&&s.overrideMimeType("text/plain; charset=utf-8"),this._xhrLevel="string"==typeof s.responseType?2:1;var r=null;return r=t.method==ss2d.LoadQueue.GET?this.buildPath(t.src,t.values):t.src,s.open(t.method||ss2d.LoadQueue.GET,r,!0),e&&s instanceof XMLHttpRequest&&1==this._xhrLevel&&s.setRequestHeader("Origin",location.origin),t.values&&t.method==ss2d.LoadQueue.POST&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),ss2d.LoadQueue.isBinary(t.type)&&(s.responseType="arraybuffer"),this._request=s,!0},_clean:function(){clearTimeout(this._loadTimeout);var t=this._request;t.onloadstart=null,t.onprogress=null,t.onabort=null,t.onerror=null,t.onload=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null},_generateTag:function(){var t=this._item.type,e=this._item.tag;switch(t){case ss2d.LoadQueue.IMAGE:return e.onload=ss2d.proxy(this._handleTagReady,this),""!=this._crossOrigin&&(e.crossOrigin="Anonymous"),e.src=this.buildPath(this._item.src,this._item.values),this._rawResponse=this._response,this._response=e,!1;case ss2d.LoadQueue.JAVASCRIPT:return e=document.createElement("script"),e.text=this._response,this._rawResponse=this._response,this._response=e,!0;case ss2d.LoadQueue.CSS:var s=document.getElementsByTagName("head")[0];if(s.appendChild(e),e.styleSheet)e.styleSheet.cssText=this._response;else{var i=document.createTextNode(this._response);e.appendChild(i)}return this._rawResponse=this._response,this._response=e,!0;case ss2d.LoadQueue.XML:var r=this._parseXML(this._response,"text/xml");return this._rawResponse=this._response,this._response=r,!0;case ss2d.LoadQueue.SVG:var r=this._parseXML(this._response,"image/svg+xml");return this._rawResponse=this._response,null!=r.documentElement?(e.appendChild(r.documentElement),this._response=e):this._response=r,!0;case ss2d.LoadQueue.JSON:case ss2d.LoadQueue.MANIFEST:var a={};try{a=JSON.parse(this._response)}catch(n){a=n}return this._rawResponse=this._response,this._response=a,!0}return!0},_parseXML:function(t,e){var s=null;if(window.DOMParser){var i=new DOMParser;s=i.parseFromString(t,e)}else s=new ActiveXObject("Microsoft.XMLDOM"),s.async=!1,s.loadXML(t);return s},_handleTagReady:function(){this._sendComplete()}})}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var s,i,r,a,n,o=gap,h=e[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),"function"==typeof rep&&(h=rep.call(e,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?h+"":"null";case"boolean":case"null":return h+"";case"object":if(!h)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(h)){for(a=h.length,s=0;a>s;s+=1)n[s]=str(s,h)||"null";return r=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+o+"]":"["+n.join(",")+"]",gap=o,r}if(rep&&"object"==typeof rep)for(a=rep.length,s=0;a>s;s+=1)"string"==typeof rep[s]&&(i=rep[s],r=str(i,h),r&&n.push(quote(i)+(gap?": ":":")+r));else for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(r=str(i,h),r&&n.push(quote(i)+(gap?": ":":")+r));return r=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+o+"}":"{"+n.join(",")+"}",gap=o,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,s){var i;if(gap="",indent="","number"==typeof s)for(i=0;s>i;i+=1)indent+=" ";else"string"==typeof s&&(indent=s);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var s,i,r=t[e];if(r&&"object"==typeof r)for(s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i=walk(r,s),void 0!==i?r[s]=i:delete r[s]);return reviver.call(t,e,r)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){ss2d.List=Class({STATIC:{instances:0},id:"",ids:null,allowOverride:!1,items:null,groups:null,listClass:null,initialize:function(t,e){this.id=t||"",this.allowOverride=e,this.listClass=ss2d.List,""==this.id&&(this.id=this._get_uniqueID()),this.items={},this.groups={},this.ids=[],ss2d.List.instances++},from:function(t){this.merge(ss2d.ListDecoder.decode(t))},"export":function(){return ss2d.ListEncoder.encode(this)},clone:function(){var t=new this.listClass(this.id,this.allowOverride);return t.items=this.items,t.groups=this.groups,t},merge:function(t){this.allowOverride=t.allowOverride;var e=t.items;for(var s in e)this.add(e[s].id,e[s].value);e=t.groups;for(var s in e){var i=e[s];this.group(i.id).allowOverride=i.allowOverride;for(var r in i.items)this.group(i.id).add(i.items[r].id,i.items[r].value)}},add:function(t,e){return this.allowOverride?this.items[t]=new ss2d.ListItem(t,e):this.items.hasOwnProperty(t)||(this.items[t]=new ss2d.ListItem(t,e)),0>this.ids.indexOf(t)&&this.ids.push(t),this},remove:function(t){return this.items.hasOwnProperty(t)&&(ss2d.ListItem(this.items[t]).dispose(),delete this.items[t],this.ids.splice(this.ids.indexOf(t),1)),this},item:function(t){return this.items[t].value},group:function(t){return this.groups.hasOwnProperty(t)||(this.groups[t]=new this.listClass(t)),this.groups[t]},index:function(t){return this.items[this.ids[t]].value},match:function(t){var e=this.items.hasOwnProperty(t);for(var s in this.items){var i=this.items[s].match(t);if(i)break}return e||i},reset:function(t){return this.clearList(this.items),this.ids.length=0,t&&(this.ids=null,this.clearList(this.groups)),this},length:function(){var t=0;for(var e in this.items)++t;return t},toListString:function(){var t=this.id;for(var e in this.items)t+="\n	"+this.items[e].id+" -> "+this.items[e].value;for(var e in this.groups){t+="\n\n	"+this.groups[e].id;for(var s in this.groups[e].items)t+="\n		"+this.groups[e].items[s].id+" -> "+this.groups[e].items[s].value}return t},clearList:function(t){for(var e in t)t[e].hasOwnProperty("dispose")&&t[e].dispose(),delete t[e]},dispose:function(){this.reset(!0),this.items=null,this.groups=null},_get_uniqueID:function(){return"List_"+ss2d.List.instances}}),ss2d.log("+++++++++"+ss2d.List)}(),function(){ss2d.ListDecoder=Class({STATIC:{decode:function(t){if(void 0==t)return null;var e=null,s=new ss2d.List;s.id=t.getAttribute("id"),t.hasOwnProperty("@allowOverride")&&(s.allowOverride=ss2d.StringUtil.toBoolean(t.getAttribute("allowOverride")));var i,r=t.child("item");for(i=0;r.length>i;i++)s.add(r[i].getAttribute("id"),ss2d.StringUtil.toNative(r[i].text()));var a=t.child("group");for(i=0;a.length>i;i++){e=a[i].getAttribute("id"),a[i].hasOwnProperty("@allowOverride")&&(s.group(e).allowOverride=ss2d.StringUtil.toBoolean(a[i].getAttribute("allowOverride")));for(var n=a[i].children(),o=0;n.length>o;o++)s.group(e).add(n[o].getAttribute("id"),ss2d.StringUtil.toNative(n[o].text()))}return s}}})}(),function(){ss2d.ListEncoder=Class({STATIC:{encode:function(t){var e;e="<list id='"+t.id+"' allowOverride='"+t.allowOverride+"'>";for(var s in t.items)e+="<item id='"+t.items[s].id+"'>"+t.items[s].value+"</item>";for(var i in t.groups){e+="<group id='"+t.groups[i].id+"' allowOverride='"+t.groups[i].allowOverride+"'>";for(var r in t.groups[i].items)e+="<item id='"+t.groups[i].items[r].id+"'>"+t.groups[i].items[r].value+"</item>";e+="</group>"}return e+="</list>",new XML(e)}}})}(),function(){ss2d.ListItem=Class({id:null,value:null,initialize:function(t,e){this.id=t,this.value=e},match:function(t){return this.value===t},toString:function(){return this.value},dispose:function(){null!=this.value&&(this.value.hasOwnProperty("dispose")&&this.value.dispose(),this.value.hasOwnProperty("kill")&&this.value.kill(),this.value.hasOwnProperty("flush")&&this.value.flush(),this.value.hasOwnProperty("destroy")&&this.value.destroy(),this.value=null)}})}(),function(){ss2d.SoundControl=Class({originalVolume:0,isPlaying:!1,controlCallbacks:null,initialize:function(){this.controlCallbacks={}},getVolume:function(){return 0},setVolume:function(){},play:function(){this.isPlaying=!0;var t=this.controlCallbacks.play;return null!=t&&t(),this},pause:function(){this.isPlaying=!1;var t=this.controlCallbacks.pause;return null!=t&&t(),this},stop:function(){this.isPlaying=!1;var t=this.controlCallbacks.stop;return null!=t&&t(),this},mute:function(){this.originalVolume=this.volume,this.volume=0;var t=this.controlCallbacks.mute;return null!=t&&t(),this},unmute:function(){this.volume=this.originalVolume||1;var t=this.controlCallbacks.unmute;return null!=t&&t.call(),this},toggleMute:function(){0==this.volume?this.unmute():this.mute()},togglePlay:function(){this.isPlaying?this.pause():this.play(0,0)},onPlay:function(t){return this.controlCallbacks.play=t,this},onPause:function(t){return this.controlCallbacks.pause=t,this},onStop:function(t){return this.controlCallbacks.stop=t,this},onCancel:function(t){return this.controlCallbacks.cancel=t,this},onMute:function(t){return this.controlCallbacks.mute=t,this},onUnMute:function(t){return this.controlCallbacks.unmute=t,this},onComplete:function(t){return this.controlCallbacks.soundComplete=t,this},onError:function(t){return this.controlCallbacks.error=t,this},dispose:function(){this.controlCallbacks=null}})}(),function(){ss2d.SoundItem=Class({Extends:ss2d.SoundControl,sound:null,loops:0,delay:0,timeout:0,lastPosition:0,url:null,loadingCallbacks:null,mIsDuplicate:!1,initialize:function(t){ss2d.SoundItem.Super.call(this),t instanceof Audio||(t=null),this.sound=t,this.lastPosition=0,this.loadingCallbacks={}},getVolume:function(){return null==this.sound?0:this.sound.volume},setVolume:function(t){null!=this.sound&&(this.sound.volume=t)},getLength:function(){return null==this.sound?0:this.sound.duration},getPosition:function(){return null==this.sound?0:this.sound.currentTime},setPosition:function(t){this.stop(),this.lastPosition=t,this.play()},getPositionPercent:function(){return this.position/this.length},setPositionPercent:function(t){this.position=this.length*t},load:function(t){var e=new Audio,s=t.split(".").pop().toUpperCase().split("?")[0],i=ss2d.sound.config[s];if(null==i||0==e.canPlayType(i.mime))throw Error("The music format '"+s+"' is not supported");return e=null,null!=this.sound&&(this.sound.removeEventListener("canplaythrough",ss2d[this._onCanPlayThroughHandler]),this.sound.removeEventListener("ended",ss2d[this._onEndedHandler]),this.sound.removeEventListener("error",ss2d[this._onErrorHandler]),ss2d[this._onCanPlayThroughHandler]=null,ss2d[this._onEndedHandler]=null,ss2d[this._onErrorHandler]=null,this.sound.pause(),this.sound=null),ss2d[this._onCanPlayThroughHandler]=this._onCanPlayThroughHandler.bind(this),ss2d[this._onEndedHandler]=this._onEndedHandler.bind(this),ss2d[this._onErrorHandler]=this._onErrorHandler.bind(this),this.sound=new Audio(t+"?"+ss2d.nocache),this.sound.addEventListener("canplaythrough",ss2d[this._onCanPlayThroughHandler]),this.sound.addEventListener("ended",ss2d[this._onEndedHandler]),this.sound.addEventListener("error",ss2d[this._onErrorHandler]),this.sound.load(),this},play:function(t,e){if(this.isPlaying){ss2d.log("音效还在播放中，克隆新音效......");var s=this.clone();return s.mIsDuplicate=!0,s.loops=-1==t?Number.MAX_VALUE:t,s.delay=e,ss2d[s._playHandler]=s._playHandler.bind(s),s.timeout=setTimeout(ss2d[s._playHandler],1e3*e),ss2d.SoundItem.Super.prototype.play.call(s)}return t=t||0,e=e||0,this.loops=-1==t?Number.MAX_VALUE:t,this.delay=e,this.cancel(),ss2d[this._playHandler]=this._playHandler.bind(this),this.timeout=setTimeout(ss2d[this._playHandler],1e3*e),ss2d.SoundItem.Super.prototype.play.call(this)},pause:function(){return this.lastPosition=this.sound.currentTime,this.sound.pause(),ss2d.SoundItem.Super.prototype.pause.call(this)},stop:function(){return this.lastPosition=0,this.sound.pause(),ss2d.SoundItem.Super.prototype.stop.call(this)},cancel:function(){clearTimeout(this.timeout);var t=this.controlCallbacks.cancel;return null!=t&&t(),this},onLoad:function(t){return this.loadingCallbacks.complete=t,this},clone:function(){var t=new ss2d.SoundItem;return t.load(this.sound.src),t},dispose:function(){this.cancel(),this.loadingCallbacks=null,null!=this.sound&&(this.sound.removeEventListener("canplaythrough",ss2d[this._onCanPlayThroughHandler]),this.sound.removeEventListener("ended",ss2d[this._onEndedHandler]),this.sound.removeEventListener("error",ss2d[this._onErrorHandler]),ss2d[this._onCanPlayThroughHandler]=null,ss2d[this._onEndedHandler]=null,ss2d[this._onErrorHandler]=null,this.sound.pause(),this.sound=null)},_playHandler:function(){this.sound.play();var t=this.controlCallbacks.play;null!=t&&t.call()},_onCanPlayThroughHandler:function(t){var e=this.loadingCallbacks.complete;null!=e&&e.apply(this,[t])},_onEndedHandler:function(t){if(this.loops--,this.loops>0)this.sound.play();else{this.isPlaying=!1,this.lastPosition=0;var e=this.controlCallbacks.soundComplete;null!=e&&e.apply(this,[t]),this.mIsDuplicate&&(ss2d.log("副本播放完毕，执行销毁!"),this.dispose())}},_onErrorHandler:function(){var t=this.controlCallbacks.cancel;null!=t&&t()}})}(),function(){ss2d.SoundManager=Class({Extends:ss2d.SoundControl,list:null,initialize:function(t){this.list=new ss2d.List(void 0==t?"sound_manager":t),this.list.listClass=ss2d.SoundManager},getVolume:function(){return this.list.index(0).volume},setVolume:function(t){for(var e in this.list.items)this.list.items[e].value.volume=t},add:function(t,e){var s=null;e instanceof Audio&&(s=e);var i=new ss2d.SoundItem(s);return this.list.add(t,i),i},remove:function(t){return this.list.remove(t),this},item:function(t){return this.list.item(t)},group:function(t){return this.list.group(t)},match:function(t){return this.list.match(t)},stop:function(){for(var t in this.list.items)this.list.items[t].value.stop();return ss2d.SoundManager.Super.stop.call(this)},play:function(t,e){for(var s in this.list.items)this.list.items[s].value.play(t,e);return ss2d.SoundManager.Super.play.call(this)},pause:function(){for(var t in this.list.items)this.list.items[t].value.pause();return ss2d.SoundManager.Super.pause.call(this)},length:function(){return this.list.length()},dispose:function(){null!=this.list&&(this.list.dispose(),this.list=null),ss2d.SoundManager.Super.dispose.call(this)}})}();